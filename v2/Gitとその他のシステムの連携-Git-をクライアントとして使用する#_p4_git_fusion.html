<!DOCTYPE html>
<html lang="ja">

<meta http-equiv="content-type" content="text/html;charset=utf-8" />
<head>

  <meta charset='utf-8'>
  



  <title>Git - Git をクライアントとして使用する</title>

 
  

  <link rel="stylesheet" media="screen" href="../../../assets/git-scm-51dae02d97f150a7e22b24f0c7497beb.css" />
  

  <!--[if (gte IE 6)&(lte IE 8)]>
  
  <![endif]-->



</head>

<body id="documentation">

  <div class="inner">
    <header>
  <a href="http://git-help-jp.github.io/"><img src="../../../images/logo%402x.png" width="110" height="46" alt="Git" /></a>
  <span id="tagline">
    <em>--</em>fast-version-control
  </span>

  <form id="search" action="http://git-scm.com/search/results">
    <input id="search-text" name="search" placeholder="Search entire site..." autocomplete="off" type="text" />
  </form>
  <div id="search-results"></div>
</header>
  </div> <!-- .inner -->

    <div class="inner">
      <div id="content-wrapper">
        <aside class="sidebar">
  <nav>
    <ul>
      <li>
        <a href="http://git-scm.com/about">About</a>
      </li>
      <li>
        <a class="active" href="http://git-scm.com/doc">Documentation</a>
        <ul class="expanded">
          <li>
            <a href="http://git-scm.com/docs">Reference</a>
          </li>
          <li>
            <a href="http://git-scm.com/book">Book</a>
          </li>
          <li>
            <a href="http://git-scm.com/videos">Videos</a>
          </li>
          <li>
            <a href="http://git-scm.com/doc/ext">External Links</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="http://git-scm.com/blog">Blog</a>
      </li>
      <li>
        <a href="http://git-scm.com/downloads">Downloads</a>
        <ul class="">
          <li>
            <a href="http://git-scm.com/downloads/guis">GUI Clients</a>
          </li>
          <li>
            <a href="http://git-scm.com/downloads/logos">Logos</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="http://git-scm.com/community">Community</a>
      </li>
    </ul>
      <hr class="sidebar">
        <p>Download this book in <a href="https://progit2.s3.amazonaws.com/ja/2015-09-12-221ea/progit-ja.825.pdf">PDF</a>,
   <a href="https://progit2.s3.amazonaws.com/ja/2015-09-12-221ea/progit-ja.825.mobi" type="application/x-mobipocket-ebook">mobi</a>,
or <a href="https://progit2.s3.amazonaws.com/ja/2015-09-12-221ea/progit-ja.825.epub" type="application/epub+zip">ePub</a> form for free.</p>

  <p>
This book is translated into
  <a href="http://git-help-jp.github.io/">git 日本語</a>
</p>
<p>
Partial translations available in
  <a href="http://git-scm.com/book/ar">Arabic</a>,
  <a href="http://git-scm.com/book/es">Español</a>,
  <a href="http://git-scm.com/book/id">Indonesian</a>,
  <a href="http://git-scm.com/book/it">Italiano</a>,
  <a href="http://git-scm.com/book/fi">Suomi</a>,
  <a href="http://git-scm.com/book/mk">Македонски</a>,
  <a href="http://git-scm.com/book/pl">Polski</a> and
  <a href="http://git-scm.com/book/tr">Türkçe</a>.
</p>
<p>
Translations started for
  <a href="http://git-scm.com/book/az">Azərbaycan dili</a>,
  <a href="http://git-scm.com/book/be">Беларуская</a>,
  <a href="http://git-scm.com/book/ca">Català</a>,
  <a href="http://git-scm.com/book/eo">Esperanto</a>,
  <a href="http://git-scm.com/book/es-ni">Español (Nicaragua)</a>,
  <a href="http://git-scm.com/book/fa" dir="rtl">فارسی</a>,
  <a href="http://git-scm.com/book/hi">हिन्दी</a>,
  <a href="http://git-scm.com/book/hu">Magyar</a>,
  <a href="http://git-scm.com/book/no-nb">Norwegian Bokmål</a>,
  <a href="http://git-scm.com/book/ro">Română</a>,
  <a href="http://git-scm.com/book/sr">Српски</a>,
  <a href="http://git-scm.com/book/th">ภาษาไทย</a>,
  <a href="http://git-scm.com/book/vi">Tiếng Việt</a>,
  <a href="http://git-scm.com/book/uk">Українська</a> and
  <a href="http://git-scm.com/book/uz/v2">Ўзбекча</a>.
</p>
<hr class="sidebar"/>
<p>
The source of this book is <a href="https://github.com/progit/progit2">hosted on GitHub.</a></br>
Patches, suggestions and comments are welcome.
</p>

  

  </nav>
</aside>
        <div id="content">
          

<div id='book-chapters'>
  <a class="dropdown-trigger" id="book-chapters-trigger" data-panel-id="chapters-dropdown" href="#">Chapters ▾</a>
<div class='dropdown-panel' id='chapters-dropdown'>
  <div class="three-column">
    <div class='column-left'>
      <ol class='book-toc'>
  <li class='chapter'>
  <h2>1. <a href="%e4%bd%bf%e3%81%84%e5%a7%8b%e3%82%81%e3%82%8b-%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e7%ae%a1%e7%90%86%e3%81%ab%e9%96%a2%e3%81%97%e3%81%a6.html">使い始める</a></h2>
    <ol>
          <li>
            1.1
            <a href="%e4%bd%bf%e3%81%84%e5%a7%8b%e3%82%81%e3%82%8b-%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e7%ae%a1%e7%90%86%e3%81%ab%e9%96%a2%e3%81%97%e3%81%a6.html">バージョン管理に関して</a>
          </li>
          <li>
            1.2
            <a href="%e4%bd%bf%e3%81%84%e5%a7%8b%e3%82%81%e3%82%8b-Git%e7%95%a5%e5%8f%b2.html">Git略史</a>
          </li>
          <li>
            1.3
            <a href="%e4%bd%bf%e3%81%84%e5%a7%8b%e3%82%81%e3%82%8b-Git%e3%81%ae%e5%9f%ba%e6%9c%ac.html">Gitの基本</a>
          </li>
          <li>
            1.4
            <a href="%e4%bd%bf%e3%81%84%e5%a7%8b%e3%82%81%e3%82%8b-%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89%e3%83%a9%e3%82%a4%e3%83%b3.html">コマンドライン</a>
          </li>
          <li>
            1.5
            <a href="%e4%bd%bf%e3%81%84%e5%a7%8b%e3%82%81%e3%82%8b-Git%e3%81%ae%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab.html">Gitのインストール</a>
          </li>
          <li>
            1.6
            <a href="%e4%bd%bf%e3%81%84%e5%a7%8b%e3%82%81%e3%82%8b-%e6%9c%80%e5%88%9d%e3%81%aeGit%e3%81%ae%e6%a7%8b%e6%88%90.html">最初のGitの構成</a>
          </li>
          <li>
            1.7
            <a href="%e4%bd%bf%e3%81%84%e5%a7%8b%e3%82%81%e3%82%8b-%e3%83%98%e3%83%ab%e3%83%97%e3%82%92%e8%a6%8b%e3%82%8b.html">ヘルプを見る</a>
          </li>
          <li>
            1.8
            <a href="%e4%bd%bf%e3%81%84%e5%a7%8b%e3%82%81%e3%82%8b-%e3%81%be%e3%81%a8%e3%82%81.html">まとめ</a>
          </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>2. <a href="Git-%e3%81%ae%e5%9f%ba%e6%9c%ac-Git-%e3%83%aa%e3%83%9d%e3%82%b8%e3%83%88%e3%83%aa%e3%81%ae%e5%8f%96%e5%be%97.html">Git の基本</a></h2>
    <ol>
          <li>
            2.1
            <a href="Git-%e3%81%ae%e5%9f%ba%e6%9c%ac-Git-%e3%83%aa%e3%83%9d%e3%82%b8%e3%83%88%e3%83%aa%e3%81%ae%e5%8f%96%e5%be%97.html">Git リポジトリの取得</a>
          </li>
          <li>
            2.2
            <a href="Git-%e3%81%ae%e5%9f%ba%e6%9c%ac-%e5%a4%89%e6%9b%b4%e5%86%85%e5%ae%b9%e3%81%ae%e3%83%aa%e3%83%9d%e3%82%b8%e3%83%88%e3%83%aa%e3%81%b8%e3%81%ae%e8%a8%98%e9%8c%b2.html">変更内容のリポジトリへの記録</a>
          </li>
          <li>
            2.3
            <a href="Git-%e3%81%ae%e5%9f%ba%e6%9c%ac-%e3%82%b3%e3%83%9f%e3%83%83%e3%83%88%e5%b1%a5%e6%ad%b4%e3%81%ae%e9%96%b2%e8%a6%a7.html">コミット履歴の閲覧</a>
          </li>
          <li>
            2.4
            <a href="Git-%e3%81%ae%e5%9f%ba%e6%9c%ac-%e4%bd%9c%e6%a5%ad%e3%81%ae%e3%82%84%e3%82%8a%e7%9b%b4%e3%81%97.html">作業のやり直し</a>
          </li>
          <li>
            2.5
            <a href="Git-%e3%81%ae%e5%9f%ba%e6%9c%ac-%e3%83%aa%e3%83%a2%e3%83%bc%e3%83%88%e3%81%a7%e3%81%ae%e4%bd%9c%e6%a5%ad.html">リモートでの作業</a>
          </li>
          <li>
            2.6
            <a href="Git-%e3%81%ae%e5%9f%ba%e6%9c%ac-%e3%82%bf%e3%82%b0.html">タグ</a>
          </li>
          <li>
            2.7
            <a href="Git-%e3%81%ae%e5%9f%ba%e6%9c%ac-Git-%e3%82%a8%e3%82%a4%e3%83%aa%e3%82%a2%e3%82%b9.html">Git エイリアス</a>
          </li>
          <li>
            2.8
            <a href="Git-%e3%81%ae%e5%9f%ba%e6%9c%ac-%e3%81%be%e3%81%a8%e3%82%81.html">まとめ</a>
          </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>3. <a href="Git-%e3%81%ae%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e6%a9%9f%e8%83%bd-%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e3%81%a8%e3%81%af.html">Git のブランチ機能</a></h2>
    <ol>
          <li>
            3.1
            <a href="Git-%e3%81%ae%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e6%a9%9f%e8%83%bd-%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e3%81%a8%e3%81%af.html">ブランチとは</a>
          </li>
          <li>
            3.2
            <a href="Git-%e3%81%ae%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e6%a9%9f%e8%83%bd-%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e3%81%a8%e3%83%9e%e3%83%bc%e3%82%b8%e3%81%ae%e5%9f%ba%e6%9c%ac.html">ブランチとマージの基本</a>
          </li>
          <li>
            3.3
            <a href="Git-%e3%81%ae%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e6%a9%9f%e8%83%bd-%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e3%81%ae%e7%ae%a1%e7%90%86.html">ブランチの管理</a>
          </li>
          <li>
            3.4
            <a href="Git-%e3%81%ae%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e6%a9%9f%e8%83%bd-%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e3%81%a7%e3%81%ae%e4%bd%9c%e6%a5%ad%e3%81%ae%e6%b5%81%e3%82%8c.html">ブランチでの作業の流れ</a>
          </li>
          <li>
            3.5
            <a href="Git-%e3%81%ae%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e6%a9%9f%e8%83%bd-%e3%83%aa%e3%83%a2%e3%83%bc%e3%83%88%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81.html">リモートブランチ</a>
          </li>
          <li>
            3.6
            <a href="Git-%e3%81%ae%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e6%a9%9f%e8%83%bd-%e3%83%aa%e3%83%99%e3%83%bc%e3%82%b9.html">リベース</a>
          </li>
          <li>
            3.7
            <a href="Git-%e3%81%ae%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e6%a9%9f%e8%83%bd-%e3%81%be%e3%81%a8%e3%82%81.html">まとめ</a>
          </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>4. <a href="Git%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc-%e3%83%97%e3%83%ad%e3%83%88%e3%82%b3%e3%83%ab.html">Gitサーバー</a></h2>
    <ol>
          <li>
            4.1
            <a href="Git%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc-%e3%83%97%e3%83%ad%e3%83%88%e3%82%b3%e3%83%ab.html">プロトコル</a>
          </li>
          <li>
            4.2
            <a href="Git%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc-%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e7%94%a8%e3%81%ae-Git-%e3%81%ae%e5%8f%96%e5%be%97.html">サーバー用の Git の取得</a>
          </li>
          <li>
            4.3
            <a href="Git%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc-SSH-%e5%85%ac%e9%96%8b%e9%8d%b5%e3%81%ae%e4%bd%9c%e6%88%90.html">SSH 公開鍵の作成</a>
          </li>
          <li>
            4.4
            <a href="Git%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc-%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e3%81%ae%e3%82%bb%e3%83%83%e3%83%88%e3%82%a2%e3%83%83%e3%83%97.html">サーバーのセットアップ</a>
          </li>
          <li>
            4.5
            <a href="Git%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc-Git-%e3%83%87%e3%83%bc%e3%83%a2%e3%83%b3.html">Git デーモン</a>
          </li>
          <li>
            4.6
            <a href="Git%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc-Smart-HTTP.html">Smart HTTP</a>
          </li>
          <li>
            4.7
            <a href="Git%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc-GitWeb.html">GitWeb</a>
          </li>
          <li>
            4.8
            <a href="Git%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc-GitLab.html">GitLab</a>
          </li>
          <li>
            4.9
            <a href="Git%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc-%e3%82%b5%e3%83%bc%e3%83%89%e3%83%91%e3%83%bc%e3%83%86%e3%82%a3%e3%81%ab%e3%82%88%e3%82%8b-Git-%e3%83%9b%e3%82%b9%e3%83%86%e3%82%a3%e3%83%b3%e3%82%b0.html">サードパーティによる Git ホスティング</a>
          </li>
          <li>
            4.10
            <a href="Git%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc-%e3%81%be%e3%81%a8%e3%82%81.html">まとめ</a>
          </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>5. <a href="Git-%e3%81%a7%e3%81%ae%e5%88%86%e6%95%a3%e4%bd%9c%e6%a5%ad-%e5%88%86%e6%95%a3%e4%bd%9c%e6%a5%ad%e3%81%ae%e6%b5%81%e3%82%8c.html">Git での分散作業</a></h2>
    <ol>
          <li>
            5.1
            <a href="Git-%e3%81%a7%e3%81%ae%e5%88%86%e6%95%a3%e4%bd%9c%e6%a5%ad-%e5%88%86%e6%95%a3%e4%bd%9c%e6%a5%ad%e3%81%ae%e6%b5%81%e3%82%8c.html">分散作業の流れ</a>
          </li>
          <li>
            5.2
            <a href="Git-%e3%81%a7%e3%81%ae%e5%88%86%e6%95%a3%e4%bd%9c%e6%a5%ad-%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%b8%e3%81%ae%e8%b2%a2%e7%8c%ae.html">プロジェクトへの貢献</a>
          </li>
          <li>
            5.3
            <a href="Git-%e3%81%a7%e3%81%ae%e5%88%86%e6%95%a3%e4%bd%9c%e6%a5%ad-%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%ae%e9%81%8b%e5%96%b6.html">プロジェクトの運営</a>
          </li>
          <li>
            5.4
            <a href="Git-%e3%81%a7%e3%81%ae%e5%88%86%e6%95%a3%e4%bd%9c%e6%a5%ad-%e3%81%be%e3%81%a8%e3%82%81.html">まとめ</a>
          </li>
    </ol>
  </li>
</ol>

    </div>
    <div class='column-middle'>
      <ol class='book-toc'>
  <li class='chapter'>
  <h2>6. <a href="GitHub-%e3%82%a2%e3%82%ab%e3%82%a6%e3%83%b3%e3%83%88%e3%81%ae%e6%ba%96%e5%82%99%e3%81%a8%e8%a8%ad%e5%ae%9a.html">GitHub</a></h2>
    <ol>
          <li>
            6.1
            <a href="GitHub-%e3%82%a2%e3%82%ab%e3%82%a6%e3%83%b3%e3%83%88%e3%81%ae%e6%ba%96%e5%82%99%e3%81%a8%e8%a8%ad%e5%ae%9a.html">アカウントの準備と設定</a>
          </li>
          <li>
            6.2
            <a href="GitHub-%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%b8%e3%81%ae%e8%b2%a2%e7%8c%ae.html">プロジェクトへの貢献</a>
          </li>
          <li>
            6.3
            <a href="GitHub-%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%ae%e3%83%a1%e3%83%b3%e3%83%86%e3%83%8a%e3%83%b3%e3%82%b9.html">プロジェクトのメンテナンス</a>
          </li>
          <li>
            6.4
            <a href="GitHub-%e7%b5%84%e7%b9%94%e3%81%ae%e7%ae%a1%e7%90%86.html">組織の管理</a>
          </li>
          <li>
            6.5
            <a href="GitHub-%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%81%ab%e3%82%88%e3%82%8b-GitHub-%e3%81%ae%e6%93%8d%e4%bd%9c.html">スクリプトによる GitHub の操作</a>
          </li>
          <li>
            6.6
            <a href="GitHub-%e3%81%be%e3%81%a8%e3%82%81.html">まとめ</a>
          </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>7. <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e3%83%aa%e3%83%93%e3%82%b8%e3%83%a7%e3%83%b3%e3%81%ae%e9%81%b8%e6%8a%9e.html">Git のさまざまなツール</a></h2>
    <ol>
          <li>
            7.1
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e3%83%aa%e3%83%93%e3%82%b8%e3%83%a7%e3%83%b3%e3%81%ae%e9%81%b8%e6%8a%9e.html">リビジョンの選択</a>
          </li>
          <li>
            7.2
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e5%af%be%e8%a9%b1%e7%9a%84%e3%81%aa%e3%82%b9%e3%83%86%e3%83%bc%e3%82%b8%e3%83%b3%e3%82%b0.html">対話的なステージング</a>
          </li>
          <li>
            7.3
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e4%bd%9c%e6%a5%ad%e3%81%ae%e9%9a%a0%e3%81%97%e3%81%8b%e3%81%9f%e3%81%a8%e6%b6%88%e3%81%97%e3%81%8b%e3%81%9f.html">作業の隠しかたと消しかた</a>
          </li>
          <li>
            7.4
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e4%bd%9c%e6%a5%ad%e5%86%85%e5%ae%b9%e3%81%b8%e3%81%ae%e7%bd%b2%e5%90%8d.html">作業内容への署名</a>
          </li>
          <li>
            7.5
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e6%a4%9c%e7%b4%a2.html">検索</a>
          </li>
          <li>
            7.6
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e6%ad%b4%e5%8f%b2%e3%81%ae%e6%9b%b8%e3%81%8d%e6%8f%9b%e3%81%88.html">歴史の書き換え</a>
          </li>
          <li>
            7.7
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e3%83%aa%e3%82%bb%e3%83%83%e3%83%88%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89%e8%a9%b3%e8%aa%ac.html">リセットコマンド詳説</a>
          </li>
          <li>
            7.8
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e9%ab%98%e5%ba%a6%e3%81%aa%e3%83%9e%e3%83%bc%e3%82%b8%e6%89%8b%e6%b3%95.html">高度なマージ手法</a>
          </li>
          <li>
            7.9
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-Rerere.html">Rerere</a>
          </li>
          <li>
            7.10
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-Git-%e3%81%ab%e3%82%88%e3%82%8b%e3%83%87%e3%83%90%e3%83%83%e3%82%b0.html">Git によるデバッグ</a>
          </li>
          <li>
            7.11
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e3%82%b5%e3%83%96%e3%83%a2%e3%82%b8%e3%83%a5%e3%83%bc%e3%83%ab.html">サブモジュール</a>
          </li>
          <li>
            7.12
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e3%83%90%e3%83%b3%e3%83%89%e3%83%ab%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%ae%e4%bd%9c%e6%88%90.html">バンドルファイルの作成</a>
          </li>
          <li>
            7.13
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-Git-%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%ae%e7%bd%ae%e3%81%8d%e6%8f%9b%e3%81%88.html">Git オブジェクトの置き換え</a>
          </li>
          <li>
            7.14
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e8%aa%8d%e8%a8%bc%e6%83%85%e5%a0%b1%e3%81%ae%e4%bf%9d%e5%ad%98.html">認証情報の保存</a>
          </li>
          <li>
            7.15
            <a href="Git-%e3%81%ae%e3%81%95%e3%81%be%e3%81%96%e3%81%be%e3%81%aa%e3%83%84%e3%83%bc%e3%83%ab-%e3%81%be%e3%81%a8%e3%82%81.html">まとめ</a>
          </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>8. <a href="Git-%e3%81%ae%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%9e%e3%82%a4%e3%82%ba-Git-%e3%81%ae%e8%a8%ad%e5%ae%9a.html">Git のカスタマイズ</a></h2>
    <ol>
          <li>
            8.1
            <a href="Git-%e3%81%ae%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%9e%e3%82%a4%e3%82%ba-Git-%e3%81%ae%e8%a8%ad%e5%ae%9a.html">Git の設定</a>
          </li>
          <li>
            8.2
            <a href="Git-%e3%81%ae%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%9e%e3%82%a4%e3%82%ba-Git-%e3%81%ae%e5%b1%9e%e6%80%a7.html">Git の属性</a>
          </li>
          <li>
            8.3
            <a href="Git-%e3%81%ae%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%9e%e3%82%a4%e3%82%ba-Git-%e3%83%95%e3%83%83%e3%82%af.html">Git フック</a>
          </li>
          <li>
            8.4
            <a href="Git-%e3%81%ae%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%9e%e3%82%a4%e3%82%ba-Git-%e3%83%9d%e3%83%aa%e3%82%b7%e3%83%bc%e3%81%ae%e5%ae%9f%e6%96%bd%e4%be%8b.html">Git ポリシーの実施例</a>
          </li>
          <li>
            8.5
            <a href="Git-%e3%81%ae%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%9e%e3%82%a4%e3%82%ba-%e3%81%be%e3%81%a8%e3%82%81.html">まとめ</a>
          </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>9. <a href="Git%e3%81%a8%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e3%81%ae%e9%80%a3%e6%90%ba-Git-%e3%82%92%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88%e3%81%a8%e3%81%97%e3%81%a6%e4%bd%bf%e7%94%a8%e3%81%99%e3%82%8b.html">Gitとその他のシステムの連携</a></h2>
    <ol>
          <li>
            9.1
            <a href="Git%e3%81%a8%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e3%81%ae%e9%80%a3%e6%90%ba-Git-%e3%82%92%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88%e3%81%a8%e3%81%97%e3%81%a6%e4%bd%bf%e7%94%a8%e3%81%99%e3%82%8b.html">Git をクライアントとして使用する</a>
          </li>
          <li>
            9.2
            <a href="Git%e3%81%a8%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e3%81%ae%e9%80%a3%e6%90%ba-Git-%e3%81%b8%e7%a7%bb%e8%a1%8c%e3%81%99%e3%82%8b.html">Git へ移行する</a>
          </li>
          <li>
            9.3
            <a href="Git%e3%81%a8%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e3%81%ae%e9%80%a3%e6%90%ba-%e3%81%be%e3%81%a8%e3%82%81.html">まとめ</a>
          </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>10. <a href="Git%e3%81%ae%e5%86%85%e5%81%b4-%e9%85%8d%e7%ae%a1%ef%bc%88Plumbing%ef%bc%89%e3%81%a8%e7%a3%81%e5%99%a8%ef%bc%88Porcelain%ef%bc%89.html">Gitの内側</a></h2>
    <ol>
          <li>
            10.1
            <a href="Git%e3%81%ae%e5%86%85%e5%81%b4-%e9%85%8d%e7%ae%a1%ef%bc%88Plumbing%ef%bc%89%e3%81%a8%e7%a3%81%e5%99%a8%ef%bc%88Porcelain%ef%bc%89.html">配管（Plumbing）と磁器（Porcelain）</a>
          </li>
          <li>
            10.2
            <a href="Git%e3%81%ae%e5%86%85%e5%81%b4-Git%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88.html">Gitオブジェクト</a>
          </li>
          <li>
            10.3
            <a href="Git%e3%81%ae%e5%86%85%e5%81%b4-Git%e3%81%ae%e5%8f%82%e7%85%a7.html">Gitの参照</a>
          </li>
          <li>
            10.4
            <a href="Git%e3%81%ae%e5%86%85%e5%81%b4-%e3%83%91%e3%83%83%e3%82%af%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab.html">パックファイル</a>
          </li>
          <li>
            10.5
            <a href="Git%e3%81%ae%e5%86%85%e5%81%b4-%e5%8f%82%e7%85%a7%e4%bb%95%e6%a7%98%ef%bc%88Refspec%ef%bc%89.html">参照仕様（Refspec）</a>
          </li>
          <li>
            10.6
            <a href="Git%e3%81%ae%e5%86%85%e5%81%b4-%e3%83%88%e3%83%a9%e3%83%b3%e3%82%b9%e3%83%95%e3%82%a1%e3%83%bc%e3%83%97%e3%83%ad%e3%83%88%e3%82%b3%e3%83%ab.html">トランスファープロトコル</a>
          </li>
          <li>
            10.7
            <a href="Git%e3%81%ae%e5%86%85%e5%81%b4-%e3%83%a1%e3%82%a4%e3%83%b3%e3%83%86%e3%83%8a%e3%83%b3%e3%82%b9%e3%81%a8%e3%83%87%e3%83%bc%e3%82%bf%e3%83%aa%e3%82%ab%e3%83%90%e3%83%aa.html">メインテナンスとデータリカバリ</a>
          </li>
          <li>
            10.8
            <a href="Git%e3%81%ae%e5%86%85%e5%81%b4-%e7%92%b0%e5%a2%83%e5%a4%89%e6%95%b0.html">環境変数</a>
          </li>
          <li>
            10.9
            <a href="Git%e3%81%ae%e5%86%85%e5%81%b4-%e8%a6%81%e7%b4%84.html">要約</a>
          </li>
    </ol>
  </li>
</ol>

    </div>
    <div class='column-right'>
      <ol class='book-toc'>
  <li class='chapter'>
  <h2>A1. <a href="%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e7%92%b0%e5%a2%83%e3%81%a7%e3%81%aeGit-%e3%82%b0%e3%83%a9%e3%83%95%e3%82%a3%e3%82%ab%e3%83%ab%e3%82%a4%e3%83%b3%e3%82%bf%e3%83%95%e3%82%a7%e3%83%bc%e3%82%b9.html">その他の環境でのGit</a></h2>
    <ol>
          <li>
            A1.1
            <a href="%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e7%92%b0%e5%a2%83%e3%81%a7%e3%81%aeGit-%e3%82%b0%e3%83%a9%e3%83%95%e3%82%a3%e3%82%ab%e3%83%ab%e3%82%a4%e3%83%b3%e3%82%bf%e3%83%95%e3%82%a7%e3%83%bc%e3%82%b9.html">グラフィカルインタフェース</a>
          </li>
          <li>
            A1.2
            <a href="%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e7%92%b0%e5%a2%83%e3%81%a7%e3%81%aeGit-Visual-Studio%e3%81%a7Git%e3%82%92%e4%bd%bf%e3%81%86.html">Visual StudioでGitを使う</a>
          </li>
          <li>
            A1.3
            <a href="%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e7%92%b0%e5%a2%83%e3%81%a7%e3%81%aeGit-Eclipse%e3%81%a7Git%e3%82%92%e4%bd%bf%e3%81%86.html">EclipseでGitを使う</a>
          </li>
          <li>
            A1.4
            <a href="%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e7%92%b0%e5%a2%83%e3%81%a7%e3%81%aeGit-Bash%e3%81%a7Git%e3%82%92%e4%bd%bf%e3%81%86.html">BashでGitを使う</a>
          </li>
          <li>
            A1.5
            <a href="%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e7%92%b0%e5%a2%83%e3%81%a7%e3%81%aeGit-Zsh%e3%81%a7Git%e3%82%92%e4%bd%bf%e3%81%86.html">ZshでGitを使う</a>
          </li>
          <li>
            A1.6
            <a href="%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e7%92%b0%e5%a2%83%e3%81%a7%e3%81%aeGit-Powershell%e3%81%a7Git%e3%82%92%e4%bd%bf%e3%81%86.html">PowershellでGitを使う</a>
          </li>
          <li>
            A1.7
            <a href="%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e7%92%b0%e5%a2%83%e3%81%a7%e3%81%aeGit-%e3%81%be%e3%81%a8%e3%82%81.html">まとめ</a>
          </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>A2. <a href="Git%e3%82%92%e3%81%82%e3%81%aa%e3%81%9f%e3%81%ae%e3%82%a2%e3%83%97%e3%83%aa%e3%82%b1%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ab%e7%b5%84%e3%81%bf%e8%be%bc%e3%82%80-Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89%e3%83%a9%e3%82%a4%e3%83%b3%e3%83%84%e3%83%bc%e3%83%ab%e3%82%92%e4%bd%bf%e3%81%86%e6%96%b9%e6%b3%95.html">Gitをあなたのアプリケーションに組み込む</a></h2>
    <ol>
          <li>
            A2.1
            <a href="Git%e3%82%92%e3%81%82%e3%81%aa%e3%81%9f%e3%81%ae%e3%82%a2%e3%83%97%e3%83%aa%e3%82%b1%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ab%e7%b5%84%e3%81%bf%e8%be%bc%e3%82%80-Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89%e3%83%a9%e3%82%a4%e3%83%b3%e3%83%84%e3%83%bc%e3%83%ab%e3%82%92%e4%bd%bf%e3%81%86%e6%96%b9%e6%b3%95.html">Gitのコマンドラインツールを使う方法</a>
          </li>
          <li>
            A2.2
            <a href="Git%e3%82%92%e3%81%82%e3%81%aa%e3%81%9f%e3%81%ae%e3%82%a2%e3%83%97%e3%83%aa%e3%82%b1%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ab%e7%b5%84%e3%81%bf%e8%be%bc%e3%82%80-Libgit2%e3%82%92%e4%bd%bf%e3%81%86%e6%96%b9%e6%b3%95.html">Libgit2を使う方法</a>
          </li>
          <li>
            A2.3
            <a href="Git%e3%82%92%e3%81%82%e3%81%aa%e3%81%9f%e3%81%ae%e3%82%a2%e3%83%97%e3%83%aa%e3%82%b1%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%ab%e7%b5%84%e3%81%bf%e8%be%bc%e3%82%80-JGit.html">JGit</a>
          </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>A3. <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e3%82%bb%e3%83%83%e3%83%88%e3%82%a2%e3%83%83%e3%83%97%e3%81%a8%e8%a8%ad%e5%ae%9a.html">Gitのコマンド</a></h2>
    <ol>
          <li>
            A3.1
            <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e3%82%bb%e3%83%83%e3%83%88%e3%82%a2%e3%83%83%e3%83%97%e3%81%a8%e8%a8%ad%e5%ae%9a.html">セットアップと設定</a>
          </li>
          <li>
            A3.2
            <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%ae%e5%8f%96%e5%be%97%e3%81%a8%e4%bd%9c%e6%88%90.html">プロジェクトの取得と作成</a>
          </li>
          <li>
            A3.3
            <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e5%9f%ba%e6%9c%ac%e7%9a%84%e3%81%aa%e3%82%b9%e3%83%8a%e3%83%83%e3%83%97%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88.html">基本的なスナップショット</a>
          </li>
          <li>
            A3.4
            <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e3%83%96%e3%83%a9%e3%83%b3%e3%83%81%e3%81%a8%e3%83%9e%e3%83%bc%e3%82%b8.html">ブランチとマージ</a>
          </li>
          <li>
            A3.5
            <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%ae%e5%85%b1%e6%9c%89%e3%81%a8%e3%82%a2%e3%83%83%e3%83%97%e3%83%87%e3%83%bc%e3%83%88.html">プロジェクトの共有とアップデート</a>
          </li>
          <li>
            A3.6
            <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e6%a4%9c%e6%9f%bb%e3%81%a8%e6%af%94%e8%bc%83.html">検査と比較</a>
          </li>
          <li>
            A3.7
            <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e3%83%87%e3%83%90%e3%83%83%e3%82%b0.html">デバッグ</a>
          </li>
          <li>
            A3.8
            <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e3%83%91%e3%83%83%e3%83%81%e3%81%ae%e9%81%a9%e7%94%a8.html">パッチの適用</a>
          </li>
          <li>
            A3.9
            <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e3%83%a1%e3%83%bc%e3%83%ab.html">メール</a>
          </li>
          <li>
            A3.10
            <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e5%a4%96%e9%83%a8%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0.html">外部システム</a>
          </li>
          <li>
            A3.11
            <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e7%ae%a1%e7%90%86.html">システム管理</a>
          </li>
          <li>
            A3.12
            <a href="Git%e3%81%ae%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89-%e9%85%8d%e7%ae%a1%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89.html">配管コマンド</a>
          </li>
    </ol>
  </li>
</ol>

    </div>
  </div>
 </div>

    <span class="light" id="edition">
      2nd Edition
    </span>
</div>

<div id='main' class="book edition2">
    <h1>9.1 Gitとその他のシステムの連携 - Git をクライアントとして使用する</h1>
  <div><a id="git-m70tp"></a><p>世の中はそんなにうまくいくものではありません。
あなたが関わることになったプロジェクトで使うバージョン管理システムを、すぐさまGitに切り替えられることはほとんどないでしょう。
また、関わっているプロジェクトが他のVCSを使っていて、もしこれがGitだったらなぁと思うことも時々あると思います。
この章の前半では、作業中のプロジェクトが他のバージョン管理システムを使っていた場合に、Git をクライアントとして使用する方法を学びます。</p><a id="git-WPtgIW"></a><h2>Git をクライアントとして使用する</h2>

<p><a data-type="indexterm" data-primary="Git as a client" id="id-gdc2hYHaIG"></a></p>

<p>Git は開発者に対し、非常に優れたユーザ体験を提供してくれます。このユーザ体験は、多くの人々がこれまでに編み出した、自分の端末上で Git を使用する方法に基づいています。それは、同じチームの他のメンバーがまったく別の VCS を使用している場合でも同様です。
そのような場合には “ブリッジ” と呼ばれるアダプタが利用できます。
ここでは、その中でも遭遇する機会が多いであろうものを取り上げます。</p>








<section data-type="sect2" id="_git_svn"><h3 id="Git-と-Subversion"><a href="#Git-と-Subversion">Git と Subversion</a></h3>

<p><a data-type="indexterm" data-primary="Subversion" id="id-YdczhbHGIqId"></a><a data-type="indexterm" data-primary="Interoperation with other VCSs" data-secondary="Subversion" id="id-k6cyHjHpIxIb"></a></p>

<p>オープンソース開発プロジェクトの大多数や、かなりの数の企業内プロジェクトが、ソースコードの管理に Subversion を利用しています。
Subversion は10年以上前から使われてきましたが、その間ほとんどの期間、オープンソースプロジェクトのVCSとしては <em>デファクトスタンダード</em> の地位にありました。
Subversion 以前は CVS がソースコード管理に広く用いられていたのですが、多くの点で両者はよく似ています。</p>

<p><a data-type="indexterm" data-primary="git commands" data-secondary="svn" id="id-OdczhDIeIoIg"></a><a data-type="indexterm" data-primary="git-svn" id="id-4GckHDIRIXIY"></a></p>

<p>Git の素晴しい機能のひとつに、Git と Subversion を双方向にブリッジする <code>git svn</code> があります。このツールを使うと、Subversion のクライアントとして Git を使うことができます。つまり、ローカルの作業では Git の機能を十分に活用することができて、あたかも Subversion を使っているかのように Subversion サーバーに変更をコミットすることができます。共同作業をしている人達が古き良き方法を使っているのと
同時に、ローカルでのブランチ作成やマージ、ステージング・エリア、リベース、チェリーピックなどの Git の機能を使うことができるということです。共同の作業環境に Git を忍び込ませておいて、仲間の開発者たちが Git より効率良く作業できるように手助けをしつつ、Git の全面的な採用のための根回しをしてゆく、というのが賢いやり方です。Subversion ブリッジは、分散VCS の素晴しい世界へのゲートウェイ・ドラッグといえるでしょう。</p>










<section data-type="sect3" id="git-svn-qWt2iNIMI9"><h4><code>git svn</code></h4>

<p>Git と Subversion の橋渡しをするコマンド群のベースとなるコマンドが <code>git svn</code> です。
この後に続くコマンドはかなりたくさんあるので、シンプルなワークフローを通してもっともよく使われるものから見ていきます。</p>

<p>注意すべきことは、<code>git svn</code> を使っているときは Subversion を相手にしているのだということです。これは、Git とはまったく異なる動きをします。
ローカルでのブランチ作成やマージは <strong>できることはできます</strong> が、作業内容をリベースするなどして歴史をできるだけ一直線に保つようにし、Git リモートリポジトリを相手にするときのように考えるのは避けましょう。</p>

<p>歴史を書き換えてもう一度プッシュしようなどとしてはいけません。また、他の開発者との共同作業のために複数の Git リポジトリに並行してプッシュするのもいけません。Subversion が扱えるのは一本の直線上の歴史だけで、ちょっとしたことですぐに混乱してしまいます。チームのメンバーの中に SVN を使う人と Git を使う人がいる場合は、全員が SVN サーバーを使って共同作業するようにしましょう。そうすれば、少しは生きやすくなります。</p>
</section><section data-type="sect3" id="-zAtrTMIDIW"><h4>セットアップ</h4>

<p>この機能を説明するには、書き込みアクセス権を持つ標準的な SVN リポジトリが必要です。
もしこのサンプルをコピーして試したいのなら、私のテスト用リポジトリの書き込み可能なコピーを作らなければなりません。
これを簡単に行うには、Subversion に付属の <code>svnsync</code> というツールを使います。
テスト用として、新しい Subversion リポジトリを Google Code 上に作りました。これは <code>protobuf</code> プロジェクトの一部で、<code>protobuf</code> は構造化されたデータを符号化してネットワーク上で転送するためのツールです。</p>

<p>まずはじめに、新しいローカル Subversion リポジトリを作ります。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> mkdir /tmp/test-svn
<code class="gp">$</code> svnadmin create /tmp/test-svn
</pre>

<p>そして、すべてのユーザーが revprop を変更できるようにします。簡単な方法は、常に 0 で終了する <code>pre-revprop-change</code> スクリプトを追加することです。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> cat /tmp/test-svn/hooks/pre-revprop-change
<code class="gp">#</code>!/bin/sh
<code class="go">exit 0;</code>
<code class="gp">$</code> chmod +x /tmp/test-svn/hooks/pre-revprop-change
</pre>

<p>これで、ローカルマシンにこのプロジェクトを同期できるようになりました。同期元と同期先のリポジトリを指定して <code>svnsync init</code> を実行します。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> svnsync init file:///tmp/test-svn <code class="se">\</code>
<code class="go">  http://progit-example.googlecode.com/svn/</code>
</pre>

<p>このコマンドは、同期を実行するためのプロパティを設定します。次に、このコマンドでコードをコピーします。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> svnsync sync file:///tmp/test-svn
<code class="go">Committed revision 1.</code>
<code class="go">Copied properties for revision 1.</code>
<code class="go">Transmitting file data .............................[...]</code>
<code class="go">Committed revision 2.</code>
<code class="go">Copied properties for revision 2.</code>
<code class="go">[…]</code>
</pre>

<p>この操作は数分で終わりますが、もし元のリポジトリのコピー先がローカルではなく別のリモートリポジトリだった場合、総コミット数がたかだか 100 にも満たなかったとしても、この処理には約一時間かかります。
Subversion では、リビジョンごとにクローンを作ってコピー先のリポジトリに投入していかなければなりません。これはばかばかしいほど非効率的ですが、簡単に済ませるにはこの方法しかないのです。</p>
</section><section data-type="sect3" id="-a9tES2InI2"><h4>使いはじめる</h4>

<p>書き込み可能な Subversion リポジトリが手に入ったので、一般的なワークフローに沿って進めましょう。まずは <code>git svn clone</code> コマンドを実行します。このコマンドは、Subversion リポジトリ全体をローカルの Git リポジトリにインポートします。どこかにホストされている実際の Subversion リポジトリから取り込む場合は <code>file:///tmp/test-svn</code> の部分を Subversion リポジトリの URL に変更しましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn clone file:///tmp/test-svn -T trunk -b branches -t tags
<code class="go">Initialized empty Git repository in /private/tmp/progit/test-svn/.git/</code>
<code class="go">r1 = dcbfb5891860124cc2e8cc616cded42624897125 (refs/remotes/origin/trunk)</code>
<code class="go">    A	m4/acx_pthread.m4</code>
<code class="go">    A	m4/stl_hash.m4</code>
<code class="go">    A	java/src/test/java/com/google/protobuf/UnknownFieldSetTest.java</code>
<code class="go">    A	java/src/test/java/com/google/protobuf/WireFormatTest.java</code>
<code class="go">…</code>
<code class="go">r75 = 556a3e1e7ad1fde0a32823fc7e4d046bcfd86dae (refs/remotes/origin/trunk)</code>
<code class="go">Found possible branch point: file:///tmp/test-svn/trunk =&gt; file:///tmp/test-svn/branches/my-calc-branch, 75</code>
<code class="go">Found branch parent: (refs/remotes/origin/my-calc-branch) 556a3e1e7ad1fde0a32823fc7e4d046bcfd86dae</code>
<code class="go">Following parent with do_switch</code>
<code class="go">Successfully followed parent</code>
<code class="go">r76 = 0fb585761df569eaecd8146c71e58d70147460a2 (refs/remotes/origin/my-calc-branch)</code>
<code class="go">Checked out HEAD:</code>
<code class="go">  file:///tmp/test-svn/trunk r75</code>
</pre>

<p>これは、指定した URL に対して <code>git svn init</code> に続けて <code>git svn fetch</code> を実行するのと同じ意味です。
しばらく時間がかかります。
test プロジェクトには 75 のコミットしかなくてコードベースもそれほど大きくありませんが、Git は各バージョンをそれぞれチェックアウトしては個別にコミットしています。
もし数百数千のコミットがあるプロジェクトで試すと、終わるまでには数時間から下手をすると数日かかってしまうかもしれません。</p>

<p><code>-T trunk -b branches -t tags</code> の部分は、この Subversion リポジトリが標準的なブランチとタグの規約に従っていることを表しています。trunk、branches、tags にもし別の名前をつけているのなら、この部分を変更します。この規約は一般に使われているものなので、単に <code>-s</code> とだけ指定することもできます。これは、先の 3 つのオプションを指定したのと同じ標準のレイアウトを表します。つまり、次のようにしても同じ意味になるということです。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn clone file:///tmp/test-svn -s
</pre>

<p>これで、ブランチやタグも取り込んだ Git リポジトリができあがりました。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git branch -a
<code class="go">* master</code>
<code class="go">  remotes/origin/my-calc-branch</code>
<code class="go">  remotes/origin/tags/2.0.2</code>
<code class="go">  remotes/origin/tags/release-2.0.1</code>
<code class="go">  remotes/origin/tags/release-2.0.2</code>
<code class="go">  remotes/origin/tags/release-2.0.2rc1</code>
<code class="go">  remotes/origin/trunk</code>
</pre>

<p>このツールが Subversion のタグをリモート参照としてどのように管理しているかに注目してください。</p>

<p><a data-type="indexterm" data-primary="git commands" data-secondary="show-ref" id="id-oOcyhLUNSxIEIQ"></a></p>

<p>Git の配管コマンド <code>show-ref</code> について、もう少し詳しく見ていきましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git show-ref
<code class="go">556a3e1e7ad1fde0a32823fc7e4d046bcfd86dae refs/heads/master</code>
<code class="go">0fb585761df569eaecd8146c71e58d70147460a2 refs/remotes/origin/my-calc-branch</code>
<code class="go">bfd2d79303166789fc73af4046651a4b35c12f0b refs/remotes/origin/tags/2.0.2</code>
<code class="go">285c2b2e36e467dd4d91c8e3c0c0e1750b3fe8ca refs/remotes/origin/tags/release-2.0.1</code>
<code class="go">cbda99cb45d9abcb9793db1d4f70ae562a969f1e refs/remotes/origin/tags/release-2.0.2</code>
<code class="go">a9f074aa89e826d6f9d30808ce5ae3ffe711feda refs/remotes/origin/tags/release-2.0.2rc1</code>
<code class="go">556a3e1e7ad1fde0a32823fc7e4d046bcfd86dae refs/remotes/origin/trunk</code>
</pre>

<p>Git が Git サーバからクローンを行う場合はこうはなりません。タグつきのリポジトリに対してクローンを行った直後は、このようになっています。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git show-ref
<code class="go">c3dcbe8488c6240392e8a5d7553bbffcb0f94ef0 refs/remotes/origin/master</code>
<code class="go">32ef1d1c7cc8c603ab78416262cc421b80a8c2df refs/remotes/origin/branch-1</code>
<code class="go">75f703a3580a9b81ead89fe1138e6da858c5ba18 refs/remotes/origin/branch-2</code>
<code class="go">23f8588dde934e8f33c263c6d8359b2ae095f863 refs/tags/v0.1.0</code>
<code class="go">7064938bd5e7ef47bfd79a685a62c1e2649e2ce7 refs/tags/v0.2.0</code>
<code class="go">6dcb09b5b57875f334f61aebed695e2e4193db5e refs/tags/v1.0.0</code>
</pre>

<p>Git は tags ディレクトリの内容をリモートブランチとして扱うのではなく、直接 <code>refs/tags</code> に格納しています。</p>
</section><section data-type="sect3" id="subversion-8zt4f7IXIr"><h4>Subversion へのコミットの書き戻し</h4>

<p>作業リポジトリを手に入れたあなたはプロジェクト上で何らかの作業を終え、コミットを上流に書き戻すことになりました。Git を SVN クライアントとして使います。どれかひとつのファイルを変更してコミットした時点では、Git上でローカルに存在するそのコミットはSubversionサーバー上には存在しません。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git commit -am <code class="s1">'Adding git-svn instructions to the README'</code>
<code class="go">[master 4af61fd] Adding git-svn instructions to the README</code>
<code class="go"> 1 file changed, 5 insertions(+)</code>
</pre>

<p>次に、これをプッシュして上流を変更しなければなりません。この変更が Subversion に対してどのように作用するのかに注意しましょう。オフラインで行った複数のコミットを、すべて一度に Subversion サーバーにプッシュすることができます。Subversion サーバーにプッシュするには <code>git svn dcommit</code> コマンドを使います。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn dcommit
<code class="go">Committing to file:///tmp/test-svn/trunk ...</code>
<code class="go">    M	README.txt</code>
<code class="go">Committed r77</code>
<code class="go">    M	README.txt</code>
<code class="go">r77 = 95e0222ba6399739834380eb10afcd73e0670bc5 (refs/remotes/origin/trunk)</code>
<code class="go">No changes between 4af61fd05045e07598c553167e0f31c84fd6ffe1 and refs/remotes/origin/trunk</code>
<code class="go">Resetting to the latest refs/remotes/origin/trunk</code>
</pre>

<p>このコマンドは、Subversionサーバーからのコード上で行われたすべてのコミットに対して個別に Subversion 上にコミットし、ローカルの Git のコミットを書き換えて一意な識別子を含むようにします。ここで重要なのは、書き換えによってすべてのローカルコミットの SHA-1 チェックサムが変化するということです。この理由もあって、Git ベースのリモートリポジトリにあるプロジェクトと Subversion サーバーを同時に使うことはおすすめできません。直近のコミットを調べれば、新たに <code>git-svn-id</code> が追記されたことがわかります。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git log -1
<code class="go">commit 95e0222ba6399739834380eb10afcd73e0670bc5</code>
<code class="go">Author: ben &lt;ben@0b684db3-b064-4277-89d1-21af03df0a68&gt;</code>
<code class="go">Date:   Thu Jul 24 03:08:36 2014 +0000</code>

<code class="go">    Adding git-svn instructions to the README</code>

<code class="go">    git-svn-id: file:///tmp/test-svn/trunk@77 0b684db3-b064-4277-89d1-21af03df0a68</code>
</pre>

<p>元のコミットの SHA-1 チェックサムが <code>4af61fd</code> で始まっていたのに対して今は <code>95e0222</code> に変わっていることに注目しましょう。Git と Subversion の両方のサーバーにプッシュしたい場合は、まず Subversion サーバーにプッシュ (<code>dcommit</code>) してから Git のほうにプッシュしなければなりません。dcommit でコミットデータが書き換わるからです。</p>
</section><section data-type="sect3" id="-5RtBUxIlIA"><h4>新しい変更の取り込み</h4>

<p>複数の開発者と作業をしていると、遅かれ早かれ、誰かがプッシュしたあとに他の人がプッシュしようとして衝突を起こすということが発生します。他の人の作業をマージするまで、その変更は却下されます。<code>git svn</code> では、このようになります。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn dcommit
<code class="go">Committing to file:///tmp/test-svn/trunk ...</code>

<code class="go">ERROR from SVN:</code>
<code class="go">Transaction is out of date: File '/trunk/README.txt' is out of date</code>
<code class="go">W: d5837c4b461b7c0e018b49d12398769d2bfc240a and refs/remotes/origin/trunk differ, using rebase:</code>
<code class="go">:100644 100644 f414c433af0fd6734428cf9d2a9fd8ba00ada145 c80b6127dd04f5fcda218730ddf3a2da4eb39138 M	README.txt</code>
<code class="go">Current branch master is up to date.</code>
<code class="go">ERROR: Not all changes have been committed into SVN, however the committed</code>
<code class="go">ones (if any) seem to be successfully integrated into the working tree.</code>
<code class="go">Please see the above messages for details.</code>
</pre>

<p>この状態を解決するには <code>git svn rebase</code> を実行します。これは、サーバー上の変更のうちまだ取り込んでいない変更をすべて取り込んでから、自分の作業をリベースします。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn rebase
<code class="go">Committing to file:///tmp/test-svn/trunk ...</code>

<code class="go">ERROR from SVN:</code>
<code class="go">Transaction is out of date: File '/trunk/README.txt' is out of date</code>
<code class="go">W: eaa029d99f87c5c822c5c29039d19111ff32ef46 and refs/remotes/origin/trunk differ, using rebase:</code>
<code class="go">:100644 100644 65536c6e30d263495c17d781962cfff12422693a b34372b25ccf4945fe5658fa381b075045e7702a M	README.txt</code>
<code class="go">First, rewinding head to replay your work on top of it...</code>
<code class="go">Applying: update foo</code>
<code class="go">Using index info to reconstruct a base tree...</code>
<code class="go">M	README.txt</code>
<code class="go">Falling back to patching base and 3-way merge...</code>
<code class="go">Auto-merging README.txt</code>
<code class="go">ERROR: Not all changes have been committed into SVN, however the committed</code>
<code class="go">ones (if any) seem to be successfully integrated into the working tree.</code>
<code class="go">Please see the above messages for details.</code>
</pre>

<p>これで手元の作業が Subversion サーバー上の最新状態の上でなされたことになったので、無事に <code>dcommit</code> することができます。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn dcommit
<code class="go">Committing to file:///tmp/test-svn/trunk ...</code>
<code class="go">    M	README.txt</code>
<code class="go">Committed r85</code>
<code class="go">    M	README.txt</code>
<code class="go">r85 = 9c29704cc0bbbed7bd58160cfb66cb9191835cd8 (refs/remotes/origin/trunk)</code>
<code class="go">No changes between 5762f56732a958d6cfda681b661d2a239cc53ef5 and refs/remotes/origin/trunk</code>
<code class="go">Resetting to the latest refs/remotes/origin/trunk</code>
</pre>

<p>ここで注意すべき点は、Git の場合は上流での変更をすべてマージしてからでなければプッシュできないけれど、<code>git svn</code> の場合は衝突さえしなければマージしなくてもプッシュできる（Subversion の挙動と同じように）ということです。
だれかがあるファイルを変更した後で自分が別のファイルを変更してプッシュしても、<code>dcommit</code> は正しく動作します。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn dcommit
<code class="go">Committing to file:///tmp/test-svn/trunk ...</code>
<code class="go">    M	configure.ac</code>
<code class="go">Committed r87</code>
<code class="go">    M	autogen.sh</code>
<code class="go">r86 = d8450bab8a77228a644b7dc0e95977ffc61adff7 (refs/remotes/origin/trunk)</code>
<code class="go">    M	configure.ac</code>
<code class="go">r87 = f3653ea40cb4e26b6281cec102e35dcba1fe17c4 (refs/remotes/origin/trunk)</code>
<code class="go">W: a0253d06732169107aa020390d9fefd2b1d92806 and refs/remotes/origin/trunk differ, using rebase:</code>
<code class="go">:100755 100755 efa5a59965fbbb5b2b0a12890f1b351bb5493c18 e757b59a9439312d80d5d43bb65d4a7d0389ed6d M	autogen.sh</code>
<code class="go">First, rewinding head to replay your work on top of it...</code>
</pre>

<p>これは忘れずに覚えておきましょう。というのも、プッシュした後の結果はどの開発者の作業環境にも存在しない状態になっているからです。たまたま衝突しなかっただけで互換性のない変更をプッシュしてしまったときに、その問題を見つけるのが難しくなります。これが、Git サーバーを使う場合と異なる点です。Git の場合はクライアントの状態をチェックしてからでないと変更を公開できませんが、SVN の場合はコミットの直前とコミット後の状態が同等であるかどうかすら確かめられないのです。</p>

<p>もし自分のコミット準備がまだできていなくても、Subversion から変更を取り込むときにもこのコマンドを使わなければなりません。<code>git svn fetch</code> でも新しいデータを取得することはできますが、<code>git svn rebase</code> はデータを取得するだけでなくローカルのコミットの更新も行います。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn rebase
<code class="go">    M	autogen.sh</code>
<code class="go">r88 = c9c5f83c64bd755368784b444bc7a0216cc1e17b (refs/remotes/origin/trunk)</code>
<code class="go">First, rewinding head to replay your work on top of it...</code>
<code class="go">Fast-forwarded master to refs/remotes/origin/trunk.</code>
</pre>

<p><code>git svn rebase</code> をときどき実行しておけば、手元のコードを常に最新の状態に保っておけます。しかし、このコマンドを実行するときには作業ディレクトリがクリーンな状態であることを確認しておく必要があります。手元で変更をしている場合は、stash で作業を退避させるか一時的にコミットしてからでないと <code>git svn rebase</code> を実行してはいけません。さもないと、もしリベースの結果としてマージが衝突すればコマンドの実行が止まってしまいます。</p>
</section><section data-type="sect3" id="git-LPtEcpIzIW"><h4>Git でのブランチに関する問題</h4>

<p>Git のワークフローに慣れてくると、トピックブランチを作ってそこで作業を行い、それをマージすることもあるでしょう。<code>git svn</code> を使って Subversion サーバーにプッシュする場合は、それらのブランチをまとめてプッシュするのではなく一つのブランチ上にリベースしてからプッシュしたくなるかもしれません。リベースしたほうがよい理由は、Subversion はリニアに歴史を管理していて Git のようなマージができないからです。<code>git svn</code> がスナップショットを Subversion のコミットに変換するときには、最初の親だけに続けます。</p>

<p>歴史が次のような状態になっているものとしましょう。<code>experiment</code> ブランチを作ってそこで 2 回のコミットを済ませ、それを <code>master</code> にマージしたところです。ここで <code>dcommit</code> すると、出力はこのようになります。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn dcommit
<code class="go">Committing to file:///tmp/test-svn/trunk ...</code>
<code class="go">    M	CHANGES.txt</code>
<code class="go">Committed r89</code>
<code class="go">    M	CHANGES.txt</code>
<code class="go">r89 = 89d492c884ea7c834353563d5d913c6adf933981 (refs/remotes/origin/trunk)</code>
<code class="go">    M	COPYING.txt</code>
<code class="go">    M	INSTALL.txt</code>
<code class="go">Committed r90</code>
<code class="go">    M	INSTALL.txt</code>
<code class="go">    M	COPYING.txt</code>
<code class="go">r90 = cb522197870e61467473391799148f6721bcf9a0 (refs/remotes/origin/trunk)</code>
<code class="go">No changes between 71af502c214ba13123992338569f4669877f55fd and refs/remotes/origin/trunk</code>
<code class="go">Resetting to the latest refs/remotes/origin/trunk</code>
</pre>

<p>歴史をマージしたブランチで <code>dcommit</code> を実行してもうまく動作します。ただし、Git プロジェクト上での歴史を見ると、<code>experiment</code> ブランチ上でのコミットは書き換えられていません。そこでのすべての変更は、SVN 上での単一のマージコミットとなっています。</p>

<p>他の人がその作業をクローンしたときには、 <code>git merge --squash</code> を実行したときのように、すべての作業をひとまとめにしたマージコミットしか見ることができません。そのコミットがどこから来たのか、そしていつコミットされたのかを知ることができないのです。</p>
</section><section data-type="sect3" id="subversion-0Qt7toI2I6"><h4>Subversion のブランチ</h4>

<p>Subversion のブランチは Git のブランチとは異なります。可能ならば、Subversion のブランチは使わないようにするのがベストでしょう。
しかし、Subversion のブランチの作成やコミットも、<code>git svn</code> を使ってすることができます。</p>
</section><section data-type="sect3" id="svn-bRtMFAILIL"><h4>新しい SVN ブランチの作成</h4>

<p>Subversion に新たなブランチを作るには <code>git svn branch [ブランチ名]</code> を実行します。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn branch opera
<code class="go">Copying file:///tmp/test-svn/trunk at r90 to file:///tmp/test-svn/branches/opera...</code>
<code class="go">Found possible branch point: file:///tmp/test-svn/trunk =&gt; file:///tmp/test-svn/branches/opera, 90</code>
<code class="go">Found branch parent: (refs/remotes/origin/opera) cb522197870e61467473391799148f6721bcf9a0</code>
<code class="go">Following parent with do_switch</code>
<code class="go">Successfully followed parent</code>
<code class="go">r91 = f1b64a3855d3c8dd84ee0ef10fa89d27f1584302 (refs/remotes/origin/opera)</code>
</pre>

<p>これは Subversion の <code>svn copy trunk branches/opera</code> コマンドと同じ意味で、Subversion サーバー上で実行されます。ここで注意すべき点は、このコマンドを実行しても新しいブランチに入ったことにはならないということです。この後コミットをすると、そのコミットはサーバーの <code>trunk</code> に対して行われます。<code>opera</code> ではありません。</p>
</section><section data-type="sect3" id="-9yteCOIAIj"><h4>アクティブなブランチの切り替え</h4>

<p>Git が dcommit の行き先のブランチを決めるときには、あなたの手元の歴史上にある Subversion ブランチのいずれかのヒントを使います。手元にはひとつしかないはずで、それは現在のブランチの歴史上の直近のコミットにある <code>git-svn-id</code> です。</p>

<p>複数のブランチを同時に操作するときは、ローカルブランチを <code>dcommit</code> でその Subversion ブランチにコミットするのかを設定することができます。そのためには、Subversion のブランチをインポートしてローカルブランチを作ります。<code>opera</code> ブランチを個別に操作したい場合は、このようなコマンドを実行します。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git branch opera remotes/origin/opera
</pre>

<p>これで、<code>opera</code> ブランチを <code>trunk</code> (手元の <code>master</code> ブランチ) にマージするときに通常の <code>git merge</code> が使えるようになりました。しかし、そのときには適切なコミットメッセージを (<code>-m</code> で) 指定しなければなりません。さもないと、有用な情報ではなく単なる "Merge branch opera" というメッセージになってしまいます。</p>

<p><code>git merge</code> を使ってこの操作を行ったとしても、そしてそれが Subversion でのマージよりもずっと簡単だったとしても (Git は自動的に適切なマージベースを検出してくれるからね)、これは通常の Git のマージコミットとは違うということを覚えておきましょう。このデータを Subversion に書き戻すことになりますが Subversion では複数の親を持つコミットは処理できません。そのため、プッシュした後は、別のブランチ上で行ったすべての操作をひとまとめにした単一のコミットに見えてしまいます。あるブランチを別のブランチにマージしたら、元のブランチに戻って作業を続けるのは困難です。Git なら簡単なのですが。<code>dcommit</code> コマンドを実行すると、どのブランチからマージしたのかという情報はすべて消えてしまいます。そのため、それ以降のマージ元の算出は間違ったものとなります。dcommit は、<code>git merge</code> の結果をまるで <code>git merge --squash</code> を実行したのと同じ状態にしてしまうのです。残念ながら、これを回避するよい方法はありません。Subversion 側にこの情報を保持する方法がないからです。Subversion をサーバーに使う以上は、常にこの制約に縛られることになります。問題を回避するには、trunk にマージしたらローカルブランチ (この場合は <code>opera</code>) を削除しなければなりません。</p>
</section><section data-type="sect3" id="subversion-yRtDhgI2IW"><h4>Subversion コマンド</h4>

<p><code>git svn</code> ツールセットには、Git への移行をしやすくするための多くのコマンドが用意されています。Subversion で使い慣れていたのと同等の機能を提供するコマンド群です。その中からいくつかを紹介します。</p>












<section data-type="sect4" id="svn-VZtGsGhAIPIr"><h4>SVN 形式のログ</h4>

<p>Subversion に慣れているので SVN が出力する形式で歴史を見たい、という場合は <code>git svn log</code> を実行しましょう。すると、コミットの歴史が SVN 形式で表示されます。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn log
<code class="go">------------------------------------------------------------------------</code>
<code class="go">r87 | schacon | 2014-05-02 16:07:37 -0700 (Sat, 02 May 2014) | 2 lines</code>

<code class="go">autogen change</code>

<code class="go">------------------------------------------------------------------------</code>
<code class="go">r86 | schacon | 2014-05-02 16:00:21 -0700 (Sat, 02 May 2014) | 2 lines</code>

<code class="go">Merge branch 'experiment'</code>

<code class="go">------------------------------------------------------------------------</code>
<code class="go">r85 | schacon | 2014-05-02 16:00:09 -0700 (Sat, 02 May 2014) | 2 lines</code>

<code class="go">updated the changelog</code>
</pre>

<p><code>git svn log</code> に関して知っておくべき重要なことがふたつあります。まず。このコマンドはオフラインで動作します。実際の <code>svn log</code> コマンドのように Subversion サーバーにデータを問い合わせたりしません。次に、すでに Subversion サーバーにコミット済みのコミットしか表示されません。つまり、ローカルの Git へのコミットのうちまだ dcommit していないものは表示されないし、その間に他の人が Subversion サーバーにコミットした内容も表示されません。最後に Subversion サーバーの状態を調べたときのログが表示されると考えればよいでしょう。</p>
</section><section data-type="sect4" id="svn-B6tLIwhrI6IM"><h4>SVN アノテーション</h4>

<p><code>git svn log</code> コマンドが <code>svn log</code> コマンドをオフラインでシミュレートしているのと同様に、<code>svn annotate</code> と同様のことを <code>git svn blame [FILE]</code> で実現できます。出力は、このようになります。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn blame README.txt
<code class="go"> 2   temporal Protocol Buffers - Google's data interchange format</code>
<code class="go"> 2   temporal Copyright 2008 Google Inc.</code>
<code class="go"> 2   temporal http://code.google.com/apis/protocolbuffers/</code>
<code class="go"> 2   temporal</code>
<code class="go">22   temporal C++ Installation - Unix</code>
<code class="go">22   temporal =======================</code>
<code class="go"> 2   temporal</code>
<code class="go">79    schacon Committing in git-svn.</code>
<code class="go">78    schacon</code>
<code class="go"> 2   temporal To build and install the C++ Protocol Buffer runtime and the Protocol</code>
<code class="go"> 2   temporal Buffer compiler (protoc) execute the following:</code>
<code class="go"> 2   temporal</code>
</pre>

<p>先ほどと同様、このコマンドも Git にローカルにコミットした内容や他から Subversion にプッシュされていたコミットは表示できません。</p>
</section><section data-type="sect4" id="svn-M6tQuvh6IqIG"><h4>SVN サーバ情報</h4>

<p><code>svn info</code> と同様のサーバー情報を取得するには <code>git svn info</code> を実行します。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn info
<code class="go">Path: .</code>
<code class="go">URL: https://schacon-test.googlecode.com/svn/trunk</code>
<code class="go">Repository Root: https://schacon-test.googlecode.com/svn</code>
<code class="go">Repository UUID: 4c93b258-373f-11de-be05-5f7a86268029</code>
<code class="go">Revision: 87</code>
<code class="go">Node Kind: directory</code>
<code class="go">Schedule: normal</code>
<code class="go">Last Changed Author: schacon</code>
<code class="go">Last Changed Rev: 87</code>
<code class="go">Last Changed Date: 2009-05-02 16:07:37 -0700 (Sat, 02 May 2009)</code>
</pre>

<p><code>blame</code> や <code>log</code> と同様にこれもオフラインで動作し、最後に Subversion サーバーと通信した時点での情報しか表示されません。</p>
</section><section data-type="sect4" id="subversion-lrt8iWhvIZIo"><h4>Subversion が無視するものを無視する</h4>

<p>どこかに <code>svn:ignore</code> プロパティが設定されている Subversion リポジトリをクローンした場合は、対応する <code>.gitignore</code> ファイルを用意したくなることでしょう。コミットすべきではないファイルを誤ってコミットしてしまうことを防ぐためにです。<code>git svn</code> には、この問題に対応するためのコマンドが二つ用意されています。まず最初が <code>git svn create-ignore</code> で、これは、対応する <code>.gitignore</code> ファイルを自動生成して次のコミットに含めます。</p>

<p>もうひとつは <code>git svn show-ignore</code> で、これは <code>.gitignore</code> に書き込む内容を標準出力に送ります。この出力を、プロジェクトの exclude ファイルにリダイレクトしましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git svn show-ignore &gt; .git/info/exclude
</pre>

<p>これで、プロジェクトに <code>.gitignore</code> ファイルを散らかさなくてもよくなります。Subversion 使いのチームの中で Git を使うのが自分だけだという場合、他のメンバーにとっては <code>.gitignore</code> ファイルは目障りでしょう。そのような場合はこの方法が使えます。</p>
</section></section><section data-type="sect3" id="git-svn-pvt2HwIjIj"><h4>Git-Svn のまとめ</h4>

<p><code>git svn</code> ツール群は、Subversion サーバーに行き詰まっている場合や使っている開発環境が Subversion サーバー前提になっている場合などに便利です。Git のできそこないだと感じるかもしれません。また、他のメンバーとの間で混乱が起こるかもしれません。トラブルを避けるために、次のガイドラインに従いましょう。</p>

<ul>
<li>
<p>Git の歴史をリニアに保ち続け、<code>git merge</code> によるマージコミットを含めないようにする。本流以外のブランチでの作業を書き戻すときは、マージではなくリベースすること。</p>
</li>
<li>
<p>Git サーバーを別途用意したりしないこと、新しい開発者がクローンするときのスピードをあげるためにサーバーを用意することはあるでしょうが、そこに <code>git-svn-id</code> エントリを持たないコミットをプッシュしてはいけません。<code>pre-receive</code> フックを追加してコミットメッセージをチェックし、<code>git-svn-id</code> がなければプッシュを拒否するようにしてもよいでしょう。</p>
</li>
</ul>
<p>これらのガイドラインを守れば、Subversion サーバーでの作業にも耐えられることでしょう。しかし、もし本物の Git サーバーに移行できるのなら、そうしたほうがチームにとってずっと利益になります。</p>
</section></section><section data-type="sect2" id="git-mercurial-DYteuvIb"><h3 id="Git-と-Mercurial"><a href="#Git-と-Mercurial">Git と Mercurial</a></h3>

<p><a data-type="indexterm" data-primary="Interoperation with other VCSs" data-secondary="Mercurial" id="id-k6crhjHOuxIb"></a>
<a data-type="indexterm" data-primary="Mercurial" id="id-OdcZHMHbuoIg"></a></p>

<p>DVCSの世界にあるのはGitだけではありません。
事実、Git以外にも様々なシステムが存在し、分散バージョン管理を正しく行う方法について、それぞれが独自の見方を持っています。
Gitを除くと、もっとも広く使われているのは Mercurial です。Git と Mercurialは多くの点で似通っています。</p>

<p>良いニュースとして、 Git のクライアントサイドの動作がお好みで、しかし作業中のプロジェクトでは Mercurial でソースを管理しているという場合、 Mercurial でホストされているリポジトリのクライアントに Git を使用するという方法があります。
Git はリモートを通してサーバリポジトリとやりとりしているので、このブリッジがリモートヘルパーとして実装されているのは驚くほどのことでもないと思います。
プロジェクト名は git-remote-hg で、 <a href="https://github.com/felipec/git-remote-hg"><em class="hyperlink">https://github.com/felipec/git-remote-hg</em></a> から取得できます。</p>










<section data-type="sect3" id="git-remote-hg-qWtZu2uMI9"><h4>git-remote-hg</h4>

<p>まず、 git-remote-hg をインストールする必要があります。
ここでは基本的に、そのファイルをどこかパスの通った場所に置く必要があります。以下のような感じです。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> curl -o ~/bin/git-remote-hg <code class="se">\</code>
<code class="go">  https://raw.githubusercontent.com/felipec/git-remote-hg/master/git-remote-hg</code>
<code class="gp">$</code> chmod +x ~/bin/git-remote-hg
</pre>

<p>…ここでは <code>~/bin</code> が <code>$PATH</code> に含まれていることを仮定しています。
git-remote-hg にはもう一つ依存先があります。 Python の <code>mercurial</code> ライブラリです。
Python をインストール済みなら、これは次のようにシンプルなコマンドで行えます。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> pip install mercurial
</pre>

<p>（Python をインストールしていないなら、まず <a href="https://www.python.org/"><em class="hyperlink">https://www.python.org/</em></a> からPython を入手してください。）</p>

<p>最後に必要なのは Mercurial のクライアントです。
インストール済みでないなら、 <a href="http://mercurial.selenic.com/"><em class="hyperlink">http://mercurial.selenic.com/</em></a> から入手してインストールしてください。</p>

<p>これで準備が整いました。
必要なのはプッシュが可能な Mercurial リポジトリだけです。
幸いなことに、 Mercurial リポジトリならどれでもこの操作が可能です。そのため、 Mercurial の使い方を学ぶときにみんなが使う "hello world" リポジトリを使用することにします。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> hg clone http://selenic.com/repo/hello /tmp/hello
</pre>
</section><section data-type="sect3" id="-zAtyiWuDIW"><h4>使いはじめる</h4>

<p>これで、都合のいい “サーバサイド” のリポジトリができたので、以降では典型的なワークフローを見ていきます。
これから見ていくように、 Git と Mercurial はよく似ているため、食い違う箇所はそう多くありません。</p>

<p>Git でいつもやるように、まずクローンをします。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git clone hg::/tmp/hello /tmp/hello-git
<code class="gp">$</code> <code class="nb">cd</code> /tmp/hello-git
<code class="gp">$</code> git log --oneline --graph --decorate
<code class="go">* ac7955c (HEAD, origin/master, origin/branches/default, origin/HEAD, refs/hg/origin/branches/default, refs/hg/origin/bookmarks/master, master) Create a makefile</code>
<code class="go">* 65bb417 Create a standard "hello, world" program</code>
</pre>

<p>標準的な <code>git clone</code> コマンドを使用して Mercurial リポジトリを操作しているのが分かると思います。
これは git-remote-hg が非常に低いレベルで動作しているためです。 git-remote-hg は Git が HTTP/S プロトコルを実装しているのと同じようなメカニズム（リモートヘルパー）を使用しています。
Git と Mercurial は両方とも、すべてのクライアントがリポジトリの歴史の完全なコピーを持つように設計されています。そのためこのコマンドは、プロジェクトのすべての歴史を含む完全なクローンを作成します。また、この処理は非常に高速に行われます。</p>

<p>git logコマンドは2つのコミットを表示しています。最新のコミットは大量の参照から指されています。
実は、これらの中のいくつかは、実際には存在しません。
<code>.git</code> ディレクトリの中に実際には何が入っているか見てみましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> tree .git/refs
<code class="go">.git/refs</code>
<code class="go">├── heads</code>
<code class="go">│   └── master</code>
<code class="go">├── hg</code>
<code class="go">│   └── origin</code>
<code class="go">│       ├── bookmarks</code>
<code class="go">│       │   └── master</code>
<code class="go">│       └── branches</code>
<code class="go">│           └── default</code>
<code class="go">├── notes</code>
<code class="go">│   └── hg</code>
<code class="go">├── remotes</code>
<code class="go">│   └── origin</code>
<code class="go">│       └── HEAD</code>
<code class="go">└── tags</code>

<code class="go">9 directories, 5 files</code>
</pre>

<p>git-remote-hg は、物事をより Git 風にしようとしているわけですが、内部的には、2つの微妙に異なるシステムの間のマッピングを管理しています。
<code>refs/hg</code> ディレクトリには実際のリモート参照が格納されています。
例えば、 <code>refs/hg/origin/branches/default</code> は “ac7955c” で始まるSHA-1（ <code>master</code> が指しているコミットを表している）を含むGitの参照ファイルです。
そのため、 <code>refs/hg</code> ディレクトリは <code>refs/remotes/origin</code> の模造品のようなものとも言えます。ただし、ブックマークとブランチの区別が追加されています。</p>

<p><code>notes/hg</code> ファイルは、 git-remote-hg が Git のコミットハッシュと Mercurial のチェンジセットIDを対応付ける際の開始点となります。
ちょっと見てみましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> cat notes/hg
<code class="go">d4c10386...</code>

<code class="gp">$</code> git cat-file -p d4c10386...
<code class="go">tree 1781c96...</code>
<code class="go">author remote-hg &lt;&gt; 1408066400 -0800</code>
<code class="go">committer remote-hg &lt;&gt; 1408066400 -0800</code>

<code class="go">Notes for master</code>

<code class="gp">$</code> git ls-tree 1781c96...
<code class="go">100644 blob ac9117f...	65bb417...</code>
<code class="go">100644 blob 485e178...	ac7955c...</code>

<code class="gp">$</code> git cat-file -p ac9117f
<code class="go">0a04b987be5ae354b710cefeba0e2d9de7ad41a9</code>
</pre>

<p><code>refs/notes/hg</code> は Git オブジェクトデータベース中にあるツリーを指しており、その内容は他のオブジェクトの名前つきリストになっています。
<code>git ls-tree</code> はツリー中の要素のモード、タイプ、オブジェクトハッシュ、およびファイル名を出力します。
ツリー中の要素の一つについて掘り下げていくと、その実体は “ac9117f” （ <code>master</code> が指しているコミットの SHA-1 ハッシュ）という名前の blob で、内容は “0a04b98” （ <code>default</code> ブランチの先端の Mercurial チェンジセットのID）であることが分かります。</p>

<p>よいニュースとして、これらすべてのことについて、我々が気にする必要はほとんどありません。
典型的なワークフローは、 Git でリモートに対して作業をする場合と大差ありません。</p>

<p>以降の話をする前に、もう一つ注意しておかなければならないことがあります。 ignoreファイルです。
Mercurial と Git はこの点について非常に似通ったメカニズムを使用しています。ですが、おそらく実際に <code>.gitignore</code> ファイルを Mercurial リポジトリへコミットしたい、ということはないでしょう。
幸いなことに、 Git にはローカルからディスク上のリポジトリへファイルを登録する際に、指定したファイルを無視する方法があります。Mercurial のフォーマットは Git と互換性があるので、単にファイルをコピーするだけで済みます。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> cp .hgignore .git/info/exclude
</pre>

<p><code>.git/info/exclude</code> ファイルは <code>.gitignore</code> と同様の働きをしますが、コミットには含まれません。</p>
</section><section data-type="sect3" id="-a9trTwunI2"><h4>ワークフロー</h4>

<p>現在、何らかの作業をやり終え、 <code>master</code> ブランチにはコミットがいくつか作成されており、それをリモートリポジトリへプッシュできる状態にあるとしましょう。
現時点では、リポジトリは次のような内容になっています。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git log --oneline --graph --decorate
<code class="go">* ba04a2a (HEAD, master) Update makefile</code>
<code class="go">* d25d16f Goodbye</code>
<code class="go">* ac7955c (origin/master, origin/branches/default, origin/HEAD, refs/hg/origin/branches/default, refs/hg/origin/bookmarks/master) Create a makefile</code>
<code class="go">* 65bb417 Create a standard "hello, world" program</code>
</pre>

<p><code>master</code> ブランチは <code>origin/master</code> よりコミット2つぶん進んでいますが、これら2つのコミットはローカルのマシン上にしかありません。
ここで、誰か他の人が、何か重要な作業をこれと同時に行っていたらどうなるか見てみましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git fetch
<code class="go">From hg::/tmp/hello</code>
<code class="go">   ac7955c..df85e87  master     -&gt; origin/master</code>
<code class="go">   ac7955c..df85e87  branches/default -&gt; origin/branches/default</code>
<code class="gp">$</code> git log --oneline --graph --decorate --all
<code class="go">* 7b07969 (refs/notes/hg) Notes for default</code>
<code class="go">* d4c1038 Notes for master</code>
<code class="go">* df85e87 (origin/master, origin/branches/default, origin/HEAD, refs/hg/origin/branches/default, refs/hg/origin/bookmarks/master) Add some documentation</code>
<code class="go">| * ba04a2a (HEAD, master) Update makefile</code>
<code class="go">| * d25d16f Goodbye</code>
<code class="go">|/</code>
<code class="go">* ac7955c Create a makefile</code>
<code class="go">* 65bb417 Create a standard "hello, world" program</code>
</pre>

<p><code>--all</code> フラグを指定したため、 “notes” 参照が表示されていますが、これは git-remote-hg が内部的に使用しているものなので、無視して構いません。
残りが期待していた内容です。 <code>origin/master</code> はコミット1つぶん進んでおり、現在この歴史は枝分かれした状態にあります。
この章で扱っている他のシステムと異なり、 Mercurial にはマージをハンドリングする機能が備わっているので、ややこしいことをする必要は何もありません。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git merge origin/master
<code class="go">Auto-merging hello.c</code>
<code class="go">Merge made by the 'recursive' strategy.</code>
<code class="go"> hello.c | 2 +-</code>
<code class="go"> 1 file changed, 1 insertion(+), 1 deletion(-)</code>
<code class="gp">$</code> git log --oneline --graph --decorate
<code class="go">*   0c64627 (HEAD, master) Merge remote-tracking branch 'origin/master'</code>
<code class="go">|\</code>
<code class="go">| * df85e87 (origin/master, origin/branches/default, origin/HEAD, refs/hg/origin/branches/default, refs/hg/origin/bookmarks/master) Add some documentation</code>
<code class="go">* | ba04a2a Update makefile</code>
<code class="go">* | d25d16f Goodbye</code>
<code class="go">|/</code>
<code class="go">* ac7955c Create a makefile</code>
<code class="go">* 65bb417 Create a standard "hello, world" program</code>
</pre>

<p>完璧です。
テストを実行して、結果はすべて正常でした。これで、成果物をチームの他のメンバーと共有できる状態になりました。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git push
<code class="go">To hg::/tmp/hello</code>
<code class="go">   df85e87..0c64627  master -&gt; master</code>
</pre>

<p>これで完了です！
Mercurial リポジトリを見てみれば、期待していた内容が分かるはずです。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> hg log -G --style compact
<code class="go">o    5[tip]:4,2   dc8fa4f932b8   2014-08-14 19:33 -0700   ben</code>
<code class="go">|\     Merge remote-tracking branch 'origin/master'</code>
<code class="go">| |</code>
<code class="go">| o  4   64f27bcefc35   2014-08-14 19:27 -0700   ben</code>
<code class="go">| |    Update makefile</code>
<code class="go">| |</code>
<code class="go">| o  3:1   4256fc29598f   2014-08-14 19:27 -0700   ben</code>
<code class="go">| |    Goodbye</code>
<code class="go">| |</code>
<code class="go">@ |  2   7db0b4848b3c   2014-08-14 19:30 -0700   ben</code>
<code class="go">|/     Add some documentation</code>
<code class="go">|</code>
<code class="go">o  1   82e55d328c8c   2005-08-26 01:21 -0700   mpm</code>
<code class="go">|    Create a makefile</code>
<code class="go">|</code>
<code class="go">o  0   0a04b987be5a   2005-08-26 01:20 -0700   mpm</code>
<code class="go">     Create a standard "hello, world" program</code>
</pre>

<p>番号 <em>2</em> のチェンジセットは Mercurial が作成したもので、番号 <em>3</em> および <em>4</em> のチェンジセットは Git で作成したコミットを git-remote-hg がプッシュして作成したものです。</p>
</section><section data-type="sect3" id="-8ztWSnuXIr"><h4>ブランチとブックマーク</h4>

<p>Git のブランチは1種類しかありません。コミットに合わせて移動する参照です。
Mercurial では、この種の参照は “ブックマーク” と呼ばれており、 Git のブランチとほぼ同じように振る舞います。</p>

<p>Mercurial の言う “ブランチ” は Git のそれよりもっと重量級の概念です。
ブランチの上でチェンジセットが作成された場合、ブランチは <em>チェンジセットと一緒に</em> 記録されます。つまり、常にリポジトリの歴史に残ります。
<code>develop</code> ブランチの上で作成されたコミットの例を次に示します。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> hg log -l 1
<code class="go">changeset:   6:8f65e5e02793</code>
<code class="go">branch:      develop</code>
<code class="go">tag:         tip</code>
<code class="go">user:        Ben Straub &lt;ben@straub.cc&gt;</code>
<code class="go">date:        Thu Aug 14 20:06:38 2014 -0700</code>
<code class="go">summary:     More documentation</code>
</pre>

<p>“branch” で始まる行に注目してください。
Git はこれを完全に複製することはできません（また、する必要もありません。いずれのタイプのブランチも Git では参照として表現されるため）が、 Mercurial にとってはこの違いが問題となるため、 git-remote-hg はこの違いを理解している必要があります。</p>

<p>Mercurial のブックマークを作成するのは、 Git のブランチを作成するのと同様に簡単です。
Git 側では、</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git checkout -b featureA
<code class="go">Switched to a new branch 'featureA'</code>
<code class="gp">$</code> git push origin featureA
<code class="go">To hg::/tmp/hello</code>
<code class="go"> * [new branch]      featureA -&gt; featureA</code>
</pre>

<p>これだけです。
Mercurial 側では、これは次のように見えます。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> hg bookmarks
<code class="go">   featureA                  5:bd5ac26f11f9</code>
<code class="gp">$</code> hg log --style compact -G
<code class="go">@  6[tip]   8f65e5e02793   2014-08-14 20:06 -0700   ben</code>
<code class="go">|    More documentation</code>
<code class="go">|</code>
<code class="go">o    5[featureA]:4,2   bd5ac26f11f9   2014-08-14 20:02 -0700   ben</code>
<code class="go">|\     Merge remote-tracking branch 'origin/master'</code>
<code class="go">| |</code>
<code class="go">| o  4   0434aaa6b91f   2014-08-14 20:01 -0700   ben</code>
<code class="go">| |    update makefile</code>
<code class="go">| |</code>
<code class="go">| o  3:1   318914536c86   2014-08-14 20:00 -0700   ben</code>
<code class="go">| |    goodbye</code>
<code class="go">| |</code>
<code class="go">o |  2   f098c7f45c4f   2014-08-14 20:01 -0700   ben</code>
<code class="go">|/     Add some documentation</code>
<code class="go">|</code>
<code class="go">o  1   82e55d328c8c   2005-08-26 01:21 -0700   mpm</code>
<code class="go">|    Create a makefile</code>
<code class="go">|</code>
<code class="go">o  0   0a04b987be5a   2005-08-26 01:20 -0700   mpm</code>
<code class="go">     Create a standard "hello, world" program</code>
</pre>

<p>リビジョン5に付いている新しいタグ <code>[featureA]</code> に注目してください。
これらの挙動は Git 側から見ると Git のブランチと非常によく似ていますが、一つ例外があります。 Git の側からブックマークを削除することはできません（これはリモートヘルパーの制限によります）。</p>

<p>“重量級” の Mercurial のブランチ上で作業をすることもできます。 <code>branches</code> 名前空間にブランチを追加します。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git checkout -b branches/permanent
<code class="go">Switched to a new branch 'branches/permanent'</code>
<code class="gp">$</code> vi Makefile
<code class="gp">$</code> git commit -am <code class="s1">'A permanent change'</code>
<code class="gp">$</code> git push origin branches/permanent
<code class="go">To hg::/tmp/hello</code>
<code class="go"> * [new branch]      branches/permanent -&gt; branches/permanent</code>
</pre>

<p>Mercurial 側ではこれは次のように見えます。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> hg branches
<code class="go">permanent                      7:a4529d07aad4</code>
<code class="go">develop                        6:8f65e5e02793</code>
<code class="go">default                        5:bd5ac26f11f9 (inactive)</code>
<code class="gp">$</code> hg log -G
<code class="go">o  changeset:   7:a4529d07aad4</code>
<code class="go">|  branch:      permanent</code>
<code class="go">|  tag:         tip</code>
<code class="go">|  parent:      5:bd5ac26f11f9</code>
<code class="go">|  user:        Ben Straub &lt;ben@straub.cc&gt;</code>
<code class="go">|  date:        Thu Aug 14 20:21:09 2014 -0700</code>
<code class="go">|  summary:     A permanent change</code>
<code class="go">|</code>
<code class="go">| @  changeset:   6:8f65e5e02793</code>
<code class="go">|/   branch:      develop</code>
<code class="go">|    user:        Ben Straub &lt;ben@straub.cc&gt;</code>
<code class="go">|    date:        Thu Aug 14 20:06:38 2014 -0700</code>
<code class="go">|    summary:     More documentation</code>
<code class="go">|</code>
<code class="go">o    changeset:   5:bd5ac26f11f9</code>
<code class="go">|\   bookmark:    featureA</code>
<code class="go">| |  parent:      4:0434aaa6b91f</code>
<code class="go">| |  parent:      2:f098c7f45c4f</code>
<code class="go">| |  user:        Ben Straub &lt;ben@straub.cc&gt;</code>
<code class="go">| |  date:        Thu Aug 14 20:02:21 2014 -0700</code>
<code class="go">| |  summary:     Merge remote-tracking branch 'origin/master'</code>
<code class="go">[...]</code>
</pre>

<p>“permanent” という名前のブランチが、 <em>7</em> とマークされたチェンジセットと一緒に記録されています。</p>

<p>Git 側では、いずれのタイプのブランチで作業をするのも変わりません。普段と同じように、チェックアウト、コミット、フェッチ、マージ、プル、プッシュが行えます。
一つ知っておくべきこととして、 Mercurial は歴史の書き換えをサポートしておらず、追記しか行えません。
対話的リベースと強制プッシュを行うと、 Mercurial リポジトリは次のような内容になります。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> hg log --style compact -G
<code class="go">o  10[tip]   99611176cbc9   2014-08-14 20:21 -0700   ben</code>
<code class="go">|    A permanent change</code>
<code class="go">|</code>
<code class="go">o  9   f23e12f939c3   2014-08-14 20:01 -0700   ben</code>
<code class="go">|    Add some documentation</code>
<code class="go">|</code>
<code class="go">o  8:1   c16971d33922   2014-08-14 20:00 -0700   ben</code>
<code class="go">|    goodbye</code>
<code class="go">|</code>
<code class="go">| o  7:5   a4529d07aad4   2014-08-14 20:21 -0700   ben</code>
<code class="go">| |    A permanent change</code>
<code class="go">| |</code>
<code class="go">| | @  6   8f65e5e02793   2014-08-14 20:06 -0700   ben</code>
<code class="go">| |/     More documentation</code>
<code class="go">| |</code>
<code class="go">| o    5[featureA]:4,2   bd5ac26f11f9   2014-08-14 20:02 -0700   ben</code>
<code class="go">| |\     Merge remote-tracking branch 'origin/master'</code>
<code class="go">| | |</code>
<code class="go">| | o  4   0434aaa6b91f   2014-08-14 20:01 -0700   ben</code>
<code class="go">| | |    update makefile</code>
<code class="go">| | |</code>
<code class="go">+---o  3:1   318914536c86   2014-08-14 20:00 -0700   ben</code>
<code class="go">| |      goodbye</code>
<code class="go">| |</code>
<code class="go">| o  2   f098c7f45c4f   2014-08-14 20:01 -0700   ben</code>
<code class="go">|/     Add some documentation</code>
<code class="go">|</code>
<code class="go">o  1   82e55d328c8c   2005-08-26 01:21 -0700   mpm</code>
<code class="go">|    Create a makefile</code>
<code class="go">|</code>
<code class="go">o  0   0a04b987be5a   2005-08-26 01:20 -0700   mpm</code>
<code class="go">     Create a standard "hello, world" program</code>
</pre>

<p>チェンジセット <em>8</em>、 <em>9</em>、 <em>10</em> が作成され、 <code>permanent</code> ブランチに紐付けられていますが、古いチェンジセットも残っています。
これは Mercurial を使用している他のチームメンバーを <strong>かなり</strong> 混乱させるので、できる限り避けましょう。</p>
</section><section data-type="sect3" id="mercurial-5RtafBulIA"><h4>Mercurial のまとめ</h4>

<p>Git と Mercurial は非常に似通っており、相互に作業してもほとんど苦になりません。
（一般的に推奨されているように）あなたのマシン上にある歴史を変更しないようにさえしていれば、相手側にあるのが Mercurial であることを意識する必要もありません。</p>
</section></section><section data-type="sect2" id="git-perforce-KZtLiwIX"><h3 id="Git-と-Perforce"><a href="#Git-と-Perforce">Git と Perforce</a></h3>

<p><a data-type="indexterm" data-primary="Interoperation with other VCSs" data-secondary="Perforce" id="id-OdczhMHyioIg"></a>
<a data-type="indexterm" data-primary="Perforce" id="id-4GckHpHqiXIY"></a></p>

<p>Perforce は企業内では非常によく使われているバージョン管理システムです。
Perforce が登場したのは 1995 年で、この章で扱う中ではもっとも古いシステムです。
そしてその言葉通り、Perforce は当時の制約に合わせて設計されています。単一の中央サーバへの常時接続を仮定しており、またローカルディスクに保存しておけるバージョンは一つだけです。
確かに、Perforce の機能と制約は、ある特定の問題にはうまく適合します。しかし、実際には Git の方が上手くいくにも関わらず、 Perforce を使用しているというプロジェクトも数多くあります。</p>

<p>Perforce と Git を混在して使用したい場合、2通りの選択肢があります。
1つ目に取り上げるのは Perforce の開発元から出ている “Git Fusion” ブリッジです。これは、 Perforce ディポのサブツリーを読み書き可能な Git リポジトリとして公開させるものです。
2つ目はクライアントサイドのブリッジである git-p4 です。これは Git を Perforce のクライアントとして使用できるようにするもので、 Perforce サーバの設定を変更することなく使用できます。</p>










<section data-type="sect3" id="_p4_git_fusion"><h4>Git Fusion</h4>

<p><a data-type="indexterm" data-primary="Perforce" data-secondary="Git Fusion" id="id-XdcRh4HouWiwIA"></a></p>

<p>Perforce は Git Fusion という製品を提供しています（ <a href="http://www.perforce.com/git-fusion"><em class="hyperlink">http://www.perforce.com/git-fusion</em></a> から入手可能）。これは、サーバサイドで Perforce サーバと Git リポジトリとを同期させます。</p>












<section data-type="sect4" id="-5RtKIBu7iVIZ"><h4>セットアップ</h4>

<p>本書の例では、 Git Fusion のもっとも簡単なインストール法として、仮想マシンをダウンロードし、 Perforce デーモンと Git Fusion をその上で実行する方法をとります。
仮想マシンイメージは <a href="http://www.perforce.com/downloads/Perforce/20-User"><em class="hyperlink">http://www.perforce.com/downloads/Perforce/20-User</em></a> から入手できます。ダウンロードが完了したら、お好みの仮想ソフトへインポートします（本書では VirtualBox を使用します）。</p>

<p>仮想マシンの初回起動時には、3つの Linux ユーザ（ <code>root</code>、 <code>perforce</code> 、および <code>git</code> ）のパスワードを設定するよう要求されます。また、同じネットワーク上の他の仮想マシンとの区別のため、インスタンス名を決めるよう要求されます。
これらすべてが完了したら、次の画面が表示されるはずです。</p>

<figure id="id-PLSZI2IEulioI2"><img src="../../en/v2/book/09-git-and-other-scms/images/git-fusion-boot.png" alt="Git Fusion 仮想マシンのブート画面"><figcaption><span class="label">Figure 9-1. </span>Git Fusion 仮想マシンのブート画面</figcaption></figure><p>ここで表示されるIPアドレスは、後で使用するので、メモしておいてください。
次に、 Perforce ユーザを作成します。
下部にある “Login” オプションを選択肢、Enterキーを押下し（または仮想マシンへSSHで接続し）、 <code>root</code> としてログインします。
続けて、次のコマンドでユーザを作成します。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> p4 -p localhost:1666 -u super user -f john
<code class="gp">$</code> p4 -p localhost:1666 -u john passwd
<code class="gp">$</code> <code class="nb">exit</code>
</pre>

<p>1つめのコマンドは、ユーザのカスタマイズのため VI エディタを起動しますが、 <code>:wq</code> に続けて Enter を入力すれば、デフォルト設定のまま利用することもできます。
2つめのコマンドは、パスワードを2度入力するようプロンプトを表示します。
シェルプロンプトで行う必要のある作業はこれで全部ですので、セッションを終了します。</p>

<p>次に手順に従って行う必要があるのは、Git が SSL 証明書を検証しないようにすることです。
Git Fusion の仮想マシンイメージには証明書が同梱されていますが、これはあなたの仮想マシンのIPアドレスとは合わないであろうドメインのものなので、 Git は HTTPS 接続を拒否してしまいます。
今回インストールした環境を今後も使い続けるつもりなら、 Perforce Git Fusion マニュアルを参考に、個別の証明書をインストールしてください。本書で例を示すだけの用途なら、以下で十分です。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> <code class="nb">export </code><code class="nv">GIT_SSL_NO_VERIFY</code><code class="o">=</code><code class="nb">true</code>
</pre>

<p>これで、すべてが動作しているかテストできるようになりました。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git clone https://10.0.1.254/Talkhouse
<code class="go">Cloning into 'Talkhouse'...</code>
<code class="go">Username for 'https://10.0.1.254': john</code>
<code class="go">Password for 'https://john@10.0.1.254':</code>
<code class="go">remote: Counting objects: 630, done.</code>
<code class="go">remote: Compressing objects: 100% (581/581), done.</code>
<code class="go">remote: Total 630 (delta 172), reused 0 (delta 0)</code>
<code class="go">Receiving objects: 100% (630/630), 1.22 MiB | 0 bytes/s, done.</code>
<code class="go">Resolving deltas: 100% (172/172), done.</code>
<code class="go">Checking connectivity... done.</code>
</pre>

<p>仮想マシンイメージには、クローンできるサンプルプロジェクトが同梱されています。
ここでは、上で作成したユーザ <code>john</code> を使用し、 HTTPS 経由でクローンしています。今回の接続時には認証情報を要求されますが、以降のリクエストでは Git の認証情報キャッシュが働くので、このステップは省略できます。</p>
</section><section data-type="sect4" id="fusion-LPt9uvuMi9I2"><h4>Fusion の設定</h4>

<p>Git Fusion をインストールし終わったら、設定を調整したいことと思います。
設定の変更は、お好きな Perforce クライアントを使用して、実際非常に簡単に行えます。Perforce サーバの <code>//.git-fusion</code> ディレクトリをワークスペースにマップするだけです。
ファイル構造は次のようになっています。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> tree
<code class="go">.</code>
<code class="go">├── objects</code>
<code class="go">│   ├── repos</code>
<code class="go">│   │   └── [...]</code>
<code class="go">│   └── trees</code>
<code class="go">│       └── [...]</code>
<code class="go">│</code>
<code class="go">├── p4gf_config</code>
<code class="go">├── repos</code>
<code class="go">│   └── Talkhouse</code>
<code class="go">│       └── p4gf_config</code>
<code class="go">└── users</code>
<code class="go">    └── p4gf_usermap</code>

<code class="go">498 directories, 287 files</code>
</pre>

<p><code>objects</code> ディレクトリは Perforce のオブジェクトを Git へ対応付ける（逆も同様）ために Git Fusion が内部的に使用しているもので、この内容に触れる必要はありません。
このディレクトリにはグローバルな <code>p4gf_config</code> 設定ファイルがあります。また、このファイルは各リポジトリにも一つずつあります – これらは、 Git Fusion の動作を決定する設定ファイルです。
ルートディレクトリにあるファイルを見てみましょう。</p>

<pre data-type="programlisting" data-code-language="ini"><code class="k">[repo-creation]</code>
<code class="na">charset</code> <code class="o">=</code> <code class="s">utf8</code>

<code class="k">[git-to-perforce]</code>
<code class="na">change-owner</code> <code class="o">=</code> <code class="s">author</code>
<code class="na">enable-git-branch-creation</code> <code class="o">=</code> <code class="s">yes</code>
<code class="na">enable-swarm-reviews</code> <code class="o">=</code> <code class="s">yes</code>
<code class="na">enable-git-merge-commits</code> <code class="o">=</code> <code class="s">yes</code>
<code class="na">enable-git-submodules</code> <code class="o">=</code> <code class="s">yes</code>
<code class="na">preflight-commit</code> <code class="o">=</code> <code class="s">none</code>
<code class="na">ignore-author-permissions</code> <code class="o">=</code> <code class="s">no</code>
<code class="na">read-permission-check</code> <code class="o">=</code> <code class="s">none</code>
<code class="na">git-merge-avoidance-after-change-num</code> <code class="o">=</code> <code class="s">12107</code>

<code class="k">[perforce-to-git]</code>
<code class="na">http-url</code> <code class="o">=</code> <code class="s">none</code>
<code class="na">ssh-url</code> <code class="o">=</code> <code class="s">none</code>

<code class="k">[@features]</code>
<code class="na">imports</code> <code class="o">=</code> <code class="s">False</code>
<code class="na">chunked-push</code> <code class="o">=</code> <code class="s">False</code>
<code class="na">matrix2</code> <code class="o">=</code> <code class="s">False</code>
<code class="na">parallel-push</code> <code class="o">=</code> <code class="s">False</code>

<code class="k">[authentication]</code>
<code class="na">email-case-sensitivity</code> <code class="o">=</code> <code class="s">no</code>
</pre>

<p>ここでは各フラグの意味については説明しませんが、このファイルが、 Git の設定ファイル同様、単なる INI ファイル形式のテキストファイルであるという点は明記しておきます。
このファイルではグローバルなオプションを設定しています。これらの設定は <code>repos/Talkhouse/p4gf_config</code> などのリポジトリ固有の設定で上書きできます。
このファイルを開くと、 <code>[@repo]</code> セクションに、グローバルなデフォルト値とは異なる設定がされているのが分かると思います。
また、次のようなセクションがあると思います。</p>

<pre data-type="programlisting" data-code-language="ini"><code class="k">[Talkhouse-master]</code>
<code class="na">git-branch-name</code> <code class="o">=</code> <code class="s">master</code>
<code class="na">view</code> <code class="o">=</code> <code class="s">//depot/Talkhouse/main-dev/... ...</code>
</pre>

<p>これは Perforce のブランチと Git のブランチのマッピングです。
このセクションの名前は好きなように決められるので、一意になるように長い名前も付けられます。
<code>git-branch-name</code> を使えば、Git にとってはとても長いディポのパスを、より扱いやすい名前に変換できます。
<code>view</code> では、 Perforce のファイルが Git のリポジトリへどう対応するかを、通常のビュー・マッピング用のシンタックスで設定します。
複数のマッピングを指定することもできます。次に例を示します。</p>

<pre data-type="programlisting" data-code-language="ini"><code class="k">[multi-project-mapping]</code>
<code class="na">git-branch-name</code> <code class="o">=</code> <code class="s">master</code>
<code class="na">view</code> <code class="o">=</code> <code class="s">//depot/project1/main/... project1/...</code>
<code class="s">       //depot/project2/mainline/... project2/...</code>
</pre>

<p>通常のワークスペースのマッピングが、ディレクトリの構造の変更を含む場合、この方法では、それも含めてGitリポジトリを複製することができます。</p>

<p>最後に取り上げるのは <code>users/p4gf_usermap</code> で、これは Perforce のユーザを Git のユーザにマッピングするファイルですが、必要ないかもしれません。
Perforce のチェンジセットを Git のコミットへ変換する際、 Git Fusion のデフォルトの動作では、 Perforce ユーザを探して、そのメールアドレスとフルネームを Git の作成者/コミッターフィールドに使用します。
逆の方向に変換する場合、デフォルトでは Git の作成者フィールドに格納されているメールアドレスで Perforce ユーザを検索し、そのユーザとしてチェンジセットを送信します（パーミッションも適用されます）。
ほとんどの場合、この動作で上手くいきます。ただし、次のマッピングファイルについても考慮しておいてください。</p>

<pre data-type="programlisting">john john@example.com "John Doe"
john johnny@appleseed.net "John Doe"
bob employeeX@example.com "Anon X. Mouse"
joe employeeY@example.com "Anon Y. Mouse"</pre>

<p>各行のフォーマットは <code>&lt;ユーザ名&gt; &lt;メールアドレス&gt; "&lt;氏名&gt;"</code> となっています。一行ごとに一つ、ユーザの対応づけを定義しています。
最初の2行は、2つの異なるメールアドレスを同一の Perforce ユーザアカウントへ対応づけています。
これは、 Git のコミットを複数のメールアドレスで作成していた（または、メールアドレスを変更した）際に、それらを同じ Perforce へ対応づけたい場合に便利です。
Perforce のチェンジセットから Git のコミットを作成する際には、 Perforce のユーザとマッチした最初の行が Git の作成者情報として使用されます。</p>

<p>最後の2行は、Git のコミットから Bob と Joe の氏名とメールアドレスが分からないようにします。
これは、社内のプロジェクトをオープンソース化したいが、社員名簿を全世界へ晒したくはない、というときに役立ちます。
注意すべき点として、すべての Git コミットが実際には存在しない1人のユーザによるものである、としたい場合を除き、メールアドレスと氏名は一意になるよう設定してください。</p>
</section><section data-type="sect4" id="-0QtLiAuvixIg"><h4>ワークフロー</h4>

<p>Perforce Git Fusion は Perforce と Git の間の双方向ブリッジです。
Gitの側から作業するとどんな感じなのかを見てみましょう。
ここでは、前述した設定ファイルを使用して “Jam” プロジェクトをマッピングしたと仮定しましょう。次のようにクローンが行えます。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git clone https://10.0.1.254/Jam
<code class="go">Cloning into 'Jam'...</code>
<code class="go">Username for 'https://10.0.1.254': john</code>
<code class="go">Password for 'https://ben@10.0.1.254':</code>
<code class="go">remote: Counting objects: 2070, done.</code>
<code class="go">remote: Compressing objects: 100% (1704/1704), done.</code>
<code class="go">Receiving objects: 100% (2070/2070), 1.21 MiB | 0 bytes/s, done.</code>
<code class="go">remote: Total 2070 (delta 1242), reused 0 (delta 0)</code>
<code class="go">Resolving deltas: 100% (1242/1242), done.</code>
<code class="go">Checking connectivity... done.</code>
<code class="gp">$</code> git branch -a
<code class="go">* master</code>
<code class="go">  remotes/origin/HEAD -&gt; origin/master</code>
<code class="go">  remotes/origin/master</code>
<code class="go">  remotes/origin/rel2.1</code>
<code class="gp">$</code> git log --oneline --decorate --graph --all
<code class="go">* 0a38c33 (origin/rel2.1) Create Jam 2.1 release branch.</code>
<code class="go">| * d254865 (HEAD, origin/master, origin/HEAD, master) Upgrade to latest metrowerks on Beos -- the Intel one.</code>
<code class="go">| * bd2f54a Put in fix for jam's NT handle leak.</code>
<code class="go">| * c0f29e7 Fix URL in a jam doc</code>
<code class="go">| * cc644ac Radstone's lynx port.</code>
<code class="go">[...]</code>
</pre>

<p>最初にこれを実行した際には、ちょっと時間がかかるかもしれません。
ここで何が行われているかというと、 Git Fusion が、 Perforce の歴史中にある、適用可能なチェンジセットをすべて Git のコミットへ変換しています。
この処理はサーバ内部で行われるので、比較的高速ですが、大量の歴史がある場合には、ちょっと時間がかかります。
以降のフェッチでは増分だけを変換するので、体感的に Git 本来のスピードにより近づきます。</p>

<p>見て分かるとおり、このリポジトリは普段作業している Git リポジトリと見た目上まったく変わりません。
3つのブランチがあり、 Git は親切なことに <code>origin/master</code> ブランチを追跡するローカルの <code>master</code> ブランチまで作成してくれています。
ちょっと作業をして、新しいコミットを2つほど作成してみましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">#</code> ...
<code class="gp">$</code> git log --oneline --decorate --graph --all
<code class="go">* cfd46ab (HEAD, master) Add documentation for new feature</code>
<code class="go">* a730d77 Whitespace</code>
<code class="go">* d254865 (origin/master, origin/HEAD) Upgrade to latest metrowerks on Beos -- the Intel one.</code>
<code class="go">* bd2f54a Put in fix for jam's NT handle leak.</code>
<code class="go">[...]</code>
</pre>

<p>新しいコミットが2つできました。
今度は、他の人が作業していなかったか確認してみましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git fetch
<code class="go">remote: Counting objects: 5, done.</code>
<code class="go">remote: Compressing objects: 100% (3/3), done.</code>
<code class="go">remote: Total 3 (delta 2), reused 0 (delta 0)</code>
<code class="go">Unpacking objects: 100% (3/3), done.</code>
<code class="go">From https://10.0.1.254/Jam</code>
<code class="go">   d254865..6afeb15  master     -&gt; origin/master</code>
<code class="gp">$</code> git log --oneline --decorate --graph --all
<code class="go">* 6afeb15 (origin/master, origin/HEAD) Update copyright</code>
<code class="go">| * cfd46ab (HEAD, master) Add documentation for new feature</code>
<code class="go">| * a730d77 Whitespace</code>
<code class="go">|/</code>
<code class="go">* d254865 Upgrade to latest metrowerks on Beos -- the Intel one.</code>
<code class="go">* bd2f54a Put in fix for jam's NT handle leak.</code>
<code class="go">[...]</code>
</pre>

<p>誰かいたみたいですよ！
このビューからは分からなかったかも知れませんが、コミット <code>6afeb15</code> は Perforce クライアントを使用して実際に作成されたものです。
Git の視点から見ると、他のコミットと変わりませんが、 そこがポイントです。
Perforce サーバがマージコミットをどのように処理するのかを見てみましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git merge origin/master
<code class="go">Auto-merging README</code>
<code class="go">Merge made by the 'recursive' strategy.</code>
<code class="go"> README | 2 +-</code>
<code class="go"> 1 file changed, 1 insertion(+), 1 deletion(-)</code>
<code class="gp">$</code> git push
<code class="go">Counting objects: 9, done.</code>
<code class="go">Delta compression using up to 8 threads.</code>
<code class="go">Compressing objects: 100% (9/9), done.</code>
<code class="go">Writing objects: 100% (9/9), 917 bytes | 0 bytes/s, done.</code>
<code class="go">Total 9 (delta 6), reused 0 (delta 0)</code>
<code class="go">remote: Perforce: 100% (3/3) Loading commit tree into memory...</code>
<code class="go">remote: Perforce: 100% (5/5) Finding child commits...</code>
<code class="go">remote: Perforce: Running git fast-export...</code>
<code class="go">remote: Perforce: 100% (3/3) Checking commits...</code>
<code class="go">remote: Processing will continue even if connection is closed.</code>
<code class="go">remote: Perforce: 100% (3/3) Copying changelists...</code>
<code class="go">remote: Perforce: Submitting new Git commit objects to Perforce: 4</code>
<code class="go">To https://10.0.1.254/Jam</code>
<code class="go">   6afeb15..89cba2b  master -&gt; master</code>
</pre>

<p>Git からは、うまくいったように見えているようです。
<code>p4v</code> のリビジョングラフ機能を使用して、 <code>README</code> ファイルの歴史を Perforce の視点から見てみましょう。</p>

<figure id="id-KqSOt4iBuDiRI5"><img src="../../en/v2/book/09-git-and-other-scms/images/git-fusion-perforce-graph.png" alt="Git でのプッシュの結果作成される Perforce のリビジョングラフ"><figcaption><span class="label">Figure 9-2. </span>Git でのプッシュの結果作成される Perforce のリビジョングラフ</figcaption></figure><p>この画面を見たことがないと、混乱するかもしれませんが、 Git の歴史をグラフィカルに表示するビューアと同じ概念を示しています。
ここでは <code>README</code> ファイルの歴史を見ています。そのため、左上のディレクトリツリーでは、様々なブランチなかからそのファイルだけを取り上げて表示しています。
右上には、そのファイルの様々なリビジョンがどのように関連しているか、ビジュアライズされたグラフが表示されます。このグラフの全体像は右下にあります。
ビューの残りの部分では、選択したリビジョン（この場合は <code>2</code> ）の詳細を表示しています。</p>

<p>ひとつ注目してもらいたいのは、このグラフが Git の歴史のグラフとそっくりだということです。
Perforce にはコミット <code>1</code> および <code>2</code> を格納する名前つきのブランチがありません。代わりに “anonymous” ブランチを <code>.git-fusion</code> ディレクトリに作成し、そこに保管しています。
同様のことは、名前つきの Git のブランチに、対応する名前つきの Perforce のブランチがない場合にも起こります（設定ファイルを使えば、後でそのようなブランチを Perforce のブランチへ対応づけることも可能です）。</p>

<p>これのほとんどは舞台裏で行われますが、最終的には、ひとつのチームの中で、ある人は Git を使用し、またある人は Perforce を使用するということができ、その双方とも他の人が何を使用しているのかを知ることはない、という結果になりました。</p>
</section><section data-type="sect4" id="git-fusion-bRtVTXupipIk"><h4>Git-Fusion のまとめ</h4>

<p>Perforce サーバへのアクセス権がある（または取得できる）なら、 Git Fusion は Git と Perforce が互いにやりとりできるようにする素晴らしい方法です。
多少の設定は必要ですが、学習曲線は急ではありません。
本節は、この章において、 Git の全機能を使用することに関して注意事項のない、数少ない節の一つです。
Perforce は指定した処理すべてを喜んでこなす、とは言いません – すでにプッシュ済みの歴史を書き換えようとしたら、 Git Fusion はそれをリジェクトします – ですが、 Git Fusion は Git そのままの感じになるよう非常に苦心しています。
また、Git のサブモジュールを使用したり（Perforce のユーザには変な風にみえますが）、ブランチのマージをしたり（Perforce 側では統合として記録されます）することも可能です。</p>

<p>Git Fusion をセットアップするようサーバの管理者を説得できなかったとしても、Git と Perforce を一緒に使用する方法は他にもあります。</p>
</section></section><section data-type="sect3" id="git-p4-a9tviKinI2"><h4>Git-p4</h4>

<p><a data-type="indexterm" data-primary="git commands" data-secondary="p4" id="id-Zdc2hWH8iGiMIk"></a></p>

<p>git-p4 は、 Git と Perforce の間の双方向ブリッジです。
git-p4 は Git リポジトリの中だけで動作するので、 Perforce サーバにおけるいかなるアクセス権も必要としません（もちろん、ユーザ権限は必要ですが）。
git-p4 には Git Fusion ほどの柔軟性や完全性はありません。ですが、やりたいであろうことの大半を、サーバ環境に対して侵襲的になることなく実施できます。</p>
<div data-type="note" id="id-PYUZIxi6i7I7">
<h6>Note</h6>
<p>git-p4 で作業を行う場合、 <code>p4</code> ツールに <code>PATH</code> が通っている必要があります。
これを書いている時点では、 <code>p4</code> は <a href="http://www.perforce.com/downloads/Perforce/20-User"><em class="hyperlink">http://www.perforce.com/downloads/Perforce/20-User</em></a> から無料で入手できます。</p>
</div>












<section data-type="sect4" id="-0Qt0uNivixIg"><h4>セットアップ</h4>

<p>例のため、前に見てきたとおり Perforce サーバを Git Fusion OVA で実行しますが、ここでは Git Fusion サーバをバイパスして、 Perforce のバージョン管理機能を直接使用します。</p>

<p><code>p4</code> コマンドラインクライアント（ git-p4 がこれに依存している）を使用するには、環境変数を2つ設定する必要があります。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> <code class="nb">export </code><code class="nv">P4PORT</code><code class="o">=</code>10.0.1.254:1666
<code class="gp">$</code> <code class="nb">export </code><code class="nv">P4USER</code><code class="o">=</code>john
</pre>
</section></section><section data-type="sect3" id="-8ztETWiXIr"><h4>使いはじめる</h4>

<p>Git でやるのと同様、最初にすることはクローンです。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git p4 clone //depot/www/live www-shallow
<code class="go">Importing from //depot/www/live into www-shallow</code>
<code class="go">Initialized empty Git repository in /private/tmp/www-shallow/.git/</code>
<code class="go">Doing initial import of //depot/www/live/ from revision #head into refs/remotes/p4/master</code>
</pre>

<p>これで、 Git の用語で言う “シャロー” クローンが作成されます（Perforce の最新のリビジョンだけが Git へインポートされます）。覚えておいて欲しいのですが、 Perforce はすべてのリビジョンをすべてのユーザに渡すようデザインされてはいません。
Git を Perforce のクライアントとして使用するにはこれで十分ですが、それ以外の用途には不十分といえます。</p>

<p>クローンが完了したら、十分な機能を備えた Git リポジトリの出来上がりです。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> <code class="nb">cd </code>myproject
<code class="gp">$</code> git log --oneline --all --graph --decorate
<code class="go">* 70eaf78 (HEAD, p4/master, p4/HEAD, master) Initial import of //depot/www/live/ from the state at revision #head</code>
</pre>

<p>Perforceを表す “p4” リモートがあることに注意が必要ですが、それ以外はすべて、通常のクローンと同じように見えます。
実際、これは少し誤解をまねきやすいのですが、実際にはリモートがあるわけではありません。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git remote -v
</pre>

<p>このリポジトリにはリモートはひとつもありません。
git-p4 は、サーバの状態を表すために参照をいくつか作成します。これが <code>git log</code> からはリモート参照のように見えます。ですが、これらの参照は Git 自身が管理しているものではなく、またそこへプッシュすることもできません。</p>
</section><section data-type="sect3" id="-5RtzSLilIA"><h4>ワークフロー</h4>

<p>オーケー、それでは作業を始めましょう。
ここでは、ある非常に重要な機能に関して進捗があり、その成果をチームの他のメンバーに見せられる状態になっているとしましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git log --oneline --all --graph --decorate
<code class="go">* 018467c (HEAD, master) Change page title</code>
<code class="go">* c0fb617 Update link</code>
<code class="go">* 70eaf78 (p4/master, p4/HEAD) Initial import of //depot/www/live/ from the state at revision #head</code>
</pre>

<p>すでに2つのコミットを作成しており、Perforce サーバへ送信する準備もできています。
今日、他の誰かが作業をしていなかったか確認してみましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git p4 sync
<code class="go">git p4 sync</code>
<code class="go">Performing incremental import into refs/remotes/p4/master git branch</code>
<code class="go">Depot paths: //depot/www/live/</code>
<code class="go">Import destination: refs/remotes/p4/master</code>
<code class="go">Importing revision 12142 (100%)</code>
<code class="gp">$</code> git log --oneline --all --graph --decorate
<code class="go">* 75cd059 (p4/master, p4/HEAD) Update copyright</code>
<code class="go">| * 018467c (HEAD, master) Change page title</code>
<code class="go">| * c0fb617 Update link</code>
<code class="go">|/</code>
<code class="go">* 70eaf78 Initial import of //depot/www/live/ from the state at revision #head</code>
</pre>

<p>誰かが作業をしていたようです。また、 <code>master</code> と <code>p4/master</code> が分岐しています。
Perforce のブランチのシステムは Git とは <em>まったく</em> 異なり、マージコミットを送信しても意味をなしません。
git-p4 では、コミットをリベースすることを推奨しており、そのためのショートカットも用意されています。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git p4 rebase
<code class="go">Performing incremental import into refs/remotes/p4/master git branch</code>
<code class="go">Depot paths: //depot/www/live/</code>
<code class="go">No changes to import!</code>
<code class="go">Rebasing the current branch onto remotes/p4/master</code>
<code class="go">First, rewinding head to replay your work on top of it...</code>
<code class="go">Applying: Update link</code>
<code class="go">Applying: Change page title</code>
<code class="go"> index.html | 2 +-</code>
<code class="go"> 1 file changed, 1 insertion(+), 1 deletion(-)</code>
</pre>

<p>出力から分かったかと思いますが、 <code>git p4 rebase</code> は <code>git p4 sync</code> の後に <code>git rebase p4/master</code> を実行するショートカットです。
実際にはもう少し賢いのですが（特に複数のブランチで作業をしている場合には）、これはよい近似と言えます。</p>

<p>これで歴史がリニアになり、変更を Perforce へ提供できる状態になりました。
<code>git p4 submit</code> を実行すると、 Git の <code>p4/master</code> から <code>master</code> の間の各コミットに対して Perforce のリビジョンを作成しようとします。
実行するとお好みのエディタが開かれます。ファイルの内容は次のような感じです。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">#</code> A Perforce Change Specification.
<code class="gp">#</code>
<code class="gp">#</code>  Change:      The change number. <code class="s1">'new'</code> on a new changelist.
<code class="gp">#</code>  Date:        The date this specification was last modified.
<code class="gp">#</code>  Client:      The client on which the changelist was created.  Read-only.
<code class="gp">#</code>  User:        The user who created the changelist.
<code class="gp">#</code>  Status:      Either <code class="s1">'pending'</code> or <code class="s1">'submitted'</code>. Read-only.
<code class="gp">#</code>  Type:        Either <code class="s1">'public'</code> or <code class="s1">'restricted'</code>. Default is <code class="s1">'public'</code>.
<code class="gp">#</code>  Description: Comments about the changelist.  Required.
<code class="gp">#</code>  Jobs:        What opened <code class="nb">jobs </code>are to be closed by this changelist.
<code class="gp">#</code>               You may delete <code class="nb">jobs </code>from this list.  <code class="o">(</code>New changelists only.<code class="o">)</code>
<code class="gp">#</code>  Files:       What opened files from the default changelist are to be added
<code class="gp">#</code>               to this changelist.  You may delete files from this list.
<code class="gp">#</code>               <code class="o">(</code>New changelists only.<code class="o">)</code>

<code class="go">Change:  new</code>

<code class="go">Client:  john_bens-mbp_8487</code>

<code class="go">User: john</code>

<code class="go">Status:  new</code>

<code class="go">Description:</code>
<code class="go">   Update link</code>

<code class="go">Files:</code>
<code class="go">   //depot/www/live/index.html   # edit</code>


<code class="gp">#</code><code class="c">####### git author ben@straub.cc does not match your p4 account.</code>
<code class="gp">#</code><code class="c">####### Use option --preserve-user to modify authorship.</code>
<code class="gp">#</code><code class="c">####### Variable git-p4.skipUserNameCheck hides this message.</code>
<code class="gp">#</code><code class="c">####### everything below this line is just the diff #######</code>
<code class="go">--- //depot/www/live/index.html  2014-08-31 18:26:05.000000000 0000</code>
<code class="go">+++ /Users/ben/john_bens-mbp_8487/john_bens-mbp_8487/depot/www/live/index.html   2014-08-31 18:26:05.000000000 0000</code>
<code class="go">@@ -60,7 +60,7 @@</code>
<code class="go"> &lt;/td&gt;</code>
<code class="go"> &lt;td valign=top&gt;</code>
<code class="go"> Source and documentation for</code>
<code class="go">-&lt;a href="http://www.perforce.com/jam/jam.html"&gt;</code>
<code class="go">+&lt;a href="jam.html"&gt;</code>
<code class="go"> Jam/MR&lt;/a&gt;,</code>
<code class="go"> a software build tool.</code>
<code class="go"> &lt;/td&gt;</code>
</pre>

<p>これは、 git-p4 が気を利かせて末尾に追加している内容を除けば、 <code>p4 submit</code> を実行した場合とほぼ同じ内容です。
git-p4 は、コミットやチェンジセットに対して氏名を指定する必要がある場合、 Git と Perforce で設定をそれぞれ個別に行えるようにしていますが、その設定を上書きしたい場合もあります。
例えば、 Git のコミットをインポートしていて、そのコミットの作成者が Perforce のユーザアカウントを持っていない場合を考えます。この場合、最終的にできるチェンジセットは（あなたではなく）そのコミットの作成者が書いたように見えるようにしたいだろうと思います。</p>

<p>git-p4 は気が利いていて、Git のコミットからメッセージをインポートして、この Perforce のチェンジセットの内容にセットしてくれます。そのため、ここではファイルの保存とエディタの終了を2回（コミット1つにつき1回）行うだけで済みます。
結果として、シェルへの出力は次のような感じになります。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git p4 submit
<code class="go">Perforce checkout for depot path //depot/www/live/ located at /Users/ben/john_bens-mbp_8487/john_bens-mbp_8487/depot/www/live/</code>
<code class="go">Synchronizing p4 checkout...</code>
<code class="go">... - file(s) up-to-date.</code>
<code class="go">Applying dbac45b Update link</code>
<code class="go">//depot/www/live/index.html#4 - opened for edit</code>
<code class="go">Change 12143 created with 1 open file(s).</code>
<code class="go">Submitting change 12143.</code>
<code class="go">Locking 1 files ...</code>
<code class="go">edit //depot/www/live/index.html#5</code>
<code class="go">Change 12143 submitted.</code>
<code class="go">Applying 905ec6a Change page title</code>
<code class="go">//depot/www/live/index.html#5 - opened for edit</code>
<code class="go">Change 12144 created with 1 open file(s).</code>
<code class="go">Submitting change 12144.</code>
<code class="go">Locking 1 files ...</code>
<code class="go">edit //depot/www/live/index.html#6</code>
<code class="go">Change 12144 submitted.</code>
<code class="go">All commits applied!</code>
<code class="go">Performing incremental import into refs/remotes/p4/master git branch</code>
<code class="go">Depot paths: //depot/www/live/</code>
<code class="go">Import destination: refs/remotes/p4/master</code>
<code class="go">Importing revision 12144 (100%)</code>
<code class="go">Rebasing the current branch onto remotes/p4/master</code>
<code class="go">First, rewinding head to replay your work on top of it...</code>
<code class="gp">$</code> git log --oneline --all --graph --decorate
<code class="go">* 775a46f (HEAD, p4/master, p4/HEAD, master) Change page title</code>
<code class="go">* 05f1ade Update link</code>
<code class="go">* 75cd059 Update copyright</code>
<code class="go">* 70eaf78 Initial import of //depot/www/live/ from the state at revision #head</code>
</pre>

<p>出力は、実際に行われている処理にもっとも近いアナロジーとして、単に <code>git push</code> を実行したかのような内容になっています。</p>

<p>注意事項として、この処理では Git の各コミットが個別の Perforce のチェンジセットに変換されます。複数のコミットを1つのチェンジセットへスカッシュしたい場合は、 <code>git p4 submit</code> の前に対話的リベースを行ってください。
また、チェンジセットとして送信された全コミットの SHA-1 ハッシュが変更される点にも注意してください。これは、 git-p4 が変換した各コミットの末尾に行を追加するためです。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git log -1
<code class="go">commit 775a46f630d8b46535fc9983cf3ebe6b9aa53145</code>
<code class="go">Author: John Doe &lt;john@example.com&gt;</code>
<code class="go">Date:   Sun Aug 31 10:31:44 2014 -0800</code>

<code class="go">    Change page title</code>

<code class="go">    [git-p4: depot-paths = "//depot/www/live/": change = 12144]</code>
</pre>

<p>マージコミットを送信しようとした場合、何が起こるでしょうか？
やってみましょう。
現在の状況は次のようになっています。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git log --oneline --all --graph --decorate
<code class="go">* 3be6fd8 (HEAD, master) Correct email address</code>
<code class="go">*   1dcbf21 Merge remote-tracking branch 'p4/master'</code>
<code class="go">|\</code>
<code class="go">| * c4689fc (p4/master, p4/HEAD) Grammar fix</code>
<code class="go">* | cbacd0a Table borders: yes please</code>
<code class="go">* | b4959b6 Trademark</code>
<code class="go">|/</code>
<code class="go">* 775a46f Change page title</code>
<code class="go">* 05f1ade Update link</code>
<code class="go">* 75cd059 Update copyright</code>
<code class="go">* 70eaf78 Initial import of //depot/www/live/ from the state at revision #head</code>
</pre>

<p>Git と Perforce の歴史が 775a46f の後で分岐しています。
Git 側に2つのコミットがあり、次に Perforce 側の HEAD とのマージコミット、さらにその次にまた別のコミットがあります。
ここでは、これらすべてのコミットを Perforce 側のチェンジセットの一番上に追加してみます。
現時点で送信した場合に何が起こるか見てみましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git p4 submit -n
<code class="go">Perforce checkout for depot path //depot/www/live/ located at /Users/ben/john_bens-mbp_8487/john_bens-mbp_8487/depot/www/live/</code>
<code class="go">Would synchronize p4 checkout in /Users/ben/john_bens-mbp_8487/john_bens-mbp_8487/depot/www/live/</code>
<code class="go">Would apply</code>
<code class="go">  b4959b6 Trademark</code>
<code class="go">  cbacd0a Table borders: yes please</code>
<code class="go">  3be6fd8 Correct email address</code>
</pre>

<p><code>-n</code> フラグは <code>--dry-run</code> の省略形で、送信コマンドを本当に実行したら何が起こるかを表示してくれます。
この場合、 Perforce サーバに存在しない3つの非マージコミットに対応するように、 Perforce のチェンジセットを3つ作成するように見えます。
これは、望む結果そのもののように見えますので、結果どうなったか見てみましょう。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git p4 submit
<code class="go">[…]</code>
<code class="gp">$</code> git log --oneline --all --graph --decorate
<code class="go">* dadbd89 (HEAD, p4/master, p4/HEAD, master) Correct email address</code>
<code class="go">* 1b79a80 Table borders: yes please</code>
<code class="go">* 0097235 Trademark</code>
<code class="go">* c4689fc Grammar fix</code>
<code class="go">* 775a46f Change page title</code>
<code class="go">* 05f1ade Update link</code>
<code class="go">* 75cd059 Update copyright</code>
<code class="go">* 70eaf78 Initial import of //depot/www/live/ from the state at revision #head</code>
</pre>

<p>送信の前にリベースを実行したかのように（実際、それが行われているのですが）、歴史がリニアになりました。
これはつまり、Git 側ではブランチを作成したり、ブランチ上で作業したり、ブランチを放棄したり、ブランチをマージしたりといった作業を自由に行えること、その際に歴史が何らかの形で Perforce と非互換になってしまう心配もないということです。
リベースが行えるなら、その内容を Perforce サーバへ送信できます。</p>












<section data-type="sect4" id="_git_p4_branches"><h4>ブランチ</h4>

<p>Perforce プロジェクトに複数のブランチがある場合でも、運の尽きというわけではありません。 git-p4 はそのようなプロジェクトを、 Git と同じように扱えます。
まず、 Perforce のディポが次のような内容になっているとしましょう。</p>

<pre data-type="programlisting">//depot
  └── project
      ├── main
      └── dev</pre>

<p>さらに、次のようなビュー・スペックを持った <code>dev</code> ブランチがあるとしましょう。</p>

<pre data-type="programlisting">//depot/project/main/... //depot/project/dev/...</pre>

<p>git-p4 はこのような状況を自動的に検出し、正しく処理を行います。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git p4 clone --detect-branches //depot/project@all
<code class="go">Importing from //depot/project@all into project</code>
<code class="go">Initialized empty Git repository in /private/tmp/project/.git/</code>
<code class="go">Importing revision 20 (50%)</code>
<code class="go">    Importing new branch project/dev</code>

<code class="go">    Resuming with change 20</code>
<code class="go">Importing revision 22 (100%)</code>
<code class="go">Updated branches: main dev</code>
<code class="gp">$</code> <code class="nb">cd </code>project<code class="p">;</code> git log --oneline --all --graph --decorate
<code class="go">* eae77ae (HEAD, p4/master, p4/HEAD, master) main</code>
<code class="go">| * 10d55fb (p4/project/dev) dev</code>
<code class="go">| * a43cfae Populate //depot/project/main/... //depot/project/dev/....</code>
<code class="go">|/</code>
<code class="go">* 2b83451 Project init</code>
</pre>

<p>ディポのパスに “@all” という指示子がついていることに注意してください。これは git-p4 に対して、パスの示すサブツリーの最新のチェンジセットだけでなく、そのパスにあったことのあるすべてのチェンジセットをクローンするように指示しています。
これは Git のクローンの考え方に近いですが、作業中のプロジェクトに長い歴史がある場合、ちょっと時間がかかるかもしれません。</p>

<p><code>--detect-branches</code> フラグは、 git-p4 に対して、Perforce のブランチを Git の参照へマッピングする際に、 Perforce のブランチ仕様を使用するように指示しています。
そのようなマッピングが Perforce サーバになかった場合（これは Perforce を使う分にはまったく問題ないやり方ですが）でも、git-p4 に対してブランチのマッピングがどのようになっているかを指示でき、同じ結果が得られます。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git init project
<code class="go">Initialized empty Git repository in /tmp/project/.git/</code>
<code class="gp">$</code> <code class="nb">cd </code>project
<code class="gp">$</code> git config git-p4.branchList main:dev
<code class="gp">$</code> git clone --detect-branches //depot/project@all .
</pre>

<p>設定値 <code>git-p4.branchList</code> に <code>main:dev</code> を設定すると、 “main” と “dev” がいずれもブランチであること、2つめのブランチは1つめのブランチの子であることを git-p4 へ示します。</p>

<p>ここで <code>git checkout -b dev p4/project/dev</code> を実行してからコミットを作成した場合でも、 git-p4 は充分に賢いので、 <code>git p4 submit</code> を実行した際には正しいブランチを対象にしてくれます。
なお、残念なことに、 git-p4 ではシャロークローンと複数ブランチを混ぜて使うことができません。巨大なプロジェクトにおいて複数のブランチで作業したい場合、ブランチごとに <code>git p4 clone</code> を実行する必要があります。</p>

<p>また、ブランチの作成や統合には、 Perforce クライアントを使用する必要があります。
git-p4 にできるのは既存のブランチに対する同期と送信だけで、それも対象にできるのはリニアなチェンジセットを一度にひとつだけです。
Git で2つのブランチをマージして新しいチェンジセットを送信しても、一塊りのファイルの変更として記録されるだけです。マージの対象となったブランチはどれかといったメタデータは失われてしまいます。</p>
</section></section><section data-type="sect3" id="git-perforce-LPtbf7izIW"><h4>Git と Perforce のまとめ</h4>

<p>git-p4 は、 Git のワークフローを Perforce サーバ上で使用できるようにします。また、それを非常にうまいやり方で可能にします。
ですが、大元を管理しているのはあくまで Perforce であり、 Git はローカルでの作業にのみ使用しているということは忘れないでください。
Git のコミットの共有については特に気をつけてください。他のメンバーが使用しているリモートがある場合、 Perforce サーバに送信していないコミットをプッシュしないよう気をつけてください。</p>

<p>ソース管理のクライアントに Perforce と Git を自由に混ぜて使いたい場合、さらにサーバの管理者を説得してインストールの許可を貰える場合、Git Fusion は Git を Perforce サーバ用の第一級のバージョン管理クライアントにしてくれます。</p>
</section></section><section data-type="sect2" id="git-tfs-G4tyTEIw"><h3 id="Git-と-TFS"><a href="#Git-と-TFS">Git と TFS</a></h3>

<p><a data-type="indexterm" data-primary="Interoperation with other VCSs" data-secondary="TFS" id="id-4GcyhpHETXIY"></a>
<a data-type="indexterm" data-primary="TFS" id="id-xAcBHbHbTeIo"></a><a data-type="indexterm" data-primary="TFVC" data-see="TFS" id="id-w7cnsKHWTbI0"></a></p>

<p>Git は Windows を利用する開発者の間でもよく使われるようになってきています。 Windows 上でコードを書いているのなら、 Microsoft の Team Foundation Server (TFS) を使用することもあるでしょう。
TFS はコラボレーションスイートで、不具合および作業成果物に対するトラッキング、 Scrum やその他の開発プロセスのサポート、コードレビュー、そしてバージョン管理といった機能が含まれています。
ここがちょっとややこしいところなのですが、 <strong>TFS</strong> 自体はサーバで、ソースコード管理には、 Git や TFS 専用のバージョン管理システム（ <strong>TFVC</strong> (Team Foundation Version Control) とも呼ばれる）をサポートしています。
TFS の Git サポートは幾分新しい機能（バージョン2013から搭載）なので、それ以前からあったツールはどれも、実際にはほぼ TFVC だけを使用している場合であっても、バージョン管理部分のことを “TFS” と呼んでいます。</p>

<p>所属しているチームは TFVC を使用しているけれど、あなた自身はバージョン管理のクライアントに Git を使用したいという場合には、そのためのプロジェクトがあります。</p>










<section data-type="sect3" id="-a9tqudTnI2"><h4>どちらのツールを使うか</h4>

<p><a data-type="indexterm" data-primary="git-tf" id="id-Zdc2hWH2udTMIk"></a><a data-type="indexterm" data-primary="git-tfs" id="id-Pdc0HDHEujToI2"></a></p>

<p>実際には、ツールは2つあります。 git-tf と git-tfs です。</p>

<p>git-tfs （ <a href="https://github.com/git-tfs/git-tfs"><em class="hyperlink">https://github.com/git-tfs/git-tfs</em></a> から入手できます）は .NET プロジェクトで、（これを書いている時点では）Windows でのみ動作します。
git-tfs は、Git リポジトリに対する操作に libgit2 の .NET バインディングを使用しています。libgit2 はライブラリ指向の Git の実装で、処理性能が高く、また Git の内部に対して柔軟な操作が行えるようになっています。
libgit2 は Git の機能を網羅的に実装してはいないため、その差を埋めるために、 git-tfs の一部の操作では実際にはコマンドライン版の Git クライアントが呼び出されています。そのため、Git リポジトリに対する操作に関して、git-tfs の設計に起因した制約は特にありません。
git-tfs は、 TFS サーバの操作に Visual Studio のアセンブリを使用しているため、TFVC 向け機能は非常に成熟しています。
また、これは Visual Studio のアセンブリにアクセスできる必要があるということでもあります。そのため、比較的新しいバージョンの Visual Studio （Visual Studio 2010以降の任意のエディション。バージョン2012以降の Visual Studio Express でもよい）か、Visual Studio SDK のインストールが必要です。</p>

<p>git-tf （ホームページは <a href="https://gittf.codeplex.com/"><em class="hyperlink">https://gittf.codeplex.com</em></a> ）は Java プロジェクトで、Java実行環境のあるあらゆるコンピュータで実行できます。
git-tf は Git リポジトリに対する操作に JGit （JVM 用の Git の実装）を使用しているため、 Git の機能という観点においては事実上制約はありません。
しかし、 TFVC に対するサポートは git-tfs と比較すると限定的です – 例えば、ブランチをサポートしていません。</p>

<p>どちらのツールにも長所と短所があり、また一方よりもう一方が向いている状況というのはいくらでもあります。
本書では、2つのツールの基本的な使用法について取り上げます。</p>
<div data-type="note" id="id-AzUzTgu6TkIb">
<h6>Note</h6>
<p>以降の手順に従って操作を行うには、 TFVC ベースのリポジトリへのアクセス権が必要です。
そのようなリポジトリは Git や Subversion のリポジトリほど世の中にありふれたものではないので、自前で作成する必要があるかもしれません。
この場合、 Codeplex (<a href="https://www.codeplex.com/"><em class="hyperlink">https://www.codeplex.com</em></a>) や Visual Studio Online (<a href="http://www.visualstudio.com/"><em class="hyperlink">http://www.visualstudio.com</em></a>) を利用するのがよいでしょう。</p>
</div>
</section><section data-type="sect3" id="git-tf-8ztqixTXIr"><h4>使いはじめる: <code>git-tf</code> の場合</h4>

<p>最初に行うことは、あらゆる Git プロジェクトと同様、クローンです。
 <code>git-tf</code> は次のような感じです。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git tf clone https://tfs.codeplex.com:443/tfs/TFS13 <code class="nv">$/</code>myproject/Main project_git
</pre>

<p>最初の引数は TFVC コレクションの URL で、2番目の引数は <code>$/プロジェクト/ブランチ</code> の形式になっており、3番目の引数はローカルに作成する Git リポジトリのパスです（3番目の引数はオプショナルです）。
git-tf は一度にひとつのブランチしか扱えません。別の TFVC ブランチへチェックインしたい場合は、対象のブランチから新しくクローンを作成する必要があります。</p>

<p>次のコマンドで、フル機能の Git リポジトリが作成できます。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> <code class="nb">cd </code>project_git
<code class="gp">$</code> git log --all --oneline --decorate
<code class="go">512e75a (HEAD, tag: TFS_C35190, origin_tfs/tfs, master) Checkin message</code>
</pre>

<p>これは <em>シャロー</em> クローンと言われるもので、最新のチェンジセットだけがダウンロードされます。
TFVC は、各クライアントが歴史の完全なコピーを持つようには設計されていません。そのため git-tf は、幾分高速な、最新のバージョンだけを取得する方法をデフォルトとしています。</p>

<p>時間があるなら、プロジェクトの歴史全体をクローンしてみるといいでしょう。 <code>--deep</code> オプションを使用します。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git tf clone https://tfs.codeplex.com:443/tfs/TFS13 <code class="nv">$/</code>myproject/Main <code class="se">\</code>
<code class="go">  project_git --deep</code>
<code class="go">Username: domain\user</code>
<code class="go">Password:</code>
<code class="go">Connecting to TFS...</code>
<code class="go">Cloning $/myproject into /tmp/project_git: 100%, done.</code>
<code class="go">Cloned 4 changesets. Cloned last changeset 35190 as d44b17a</code>
<code class="gp">$</code> <code class="nb">cd </code>project_git
<code class="gp">$</code> git log --all --oneline --decorate
<code class="go">d44b17a (HEAD, tag: TFS_C35190, origin_tfs/tfs, master) Goodbye</code>
<code class="go">126aa7b (tag: TFS_C35189)</code>
<code class="go">8f77431 (tag: TFS_C35178) FIRST</code>
<code class="go">0745a25 (tag: TFS_C35177) Created team project folder $/tfvctest via the \</code>
<code class="go">        Team Project Creation Wizard</code>
</pre>

<p><code>TFS_C35189</code> のような名前のタグに注目してください。これは、Git のどのコミットが、 TFVC のどのチェンジセットに対応しているかを分かりやすくするための機能です。
タグで表現するというのは上手い方法です。簡単な log コマンドだけで、どのコミットが TFVC 中のどのスナップショットに対応しているか確認できます。
なお、このタグ付けは必須ではありません（実際、 <code>git config git-tf.tag false</code> で無効にできます） – git-tf では、コミットとチェンジセットとのマッピングは <code>.git/git-tf</code> に保存されています。</p>
</section><section data-type="sect3" id="git-tfs-5RtOT7TlIA"><h4>使いはじめる: <code>git-tfs</code> の場合</h4>

<p>git-tfs のクローン処理は、 git-tf とは少し異なります。
見てみましょう。</p>

<pre data-type="programlisting" data-code-language="powershell"><code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">tfs</code> <code class="n">clone</code> <code class="p">-</code><code class="n">-with-branches</code> <code class="p">\</code>
    <code class="n">https</code><code class="err">:</code><code class="p">//</code><code class="n">username</code><code class="p">.</code><code class="n">visualstudio</code><code class="p">.</code><code class="n">com</code><code class="p">/</code><code class="n">DefaultCollection</code> <code class="p">\</code>
    <code class="p">$/</code><code class="n">project</code><code class="p">/</code><code class="n">Trunk</code> <code class="n">project_git</code>
<code class="n">Initialized</code> <code class="n">empty</code> <code class="n">Git</code> <code class="n">repository</code> <code class="k">in</code> <code class="n">C</code><code class="err">:</code><code class="p">/</code><code class="n">Users</code><code class="p">/</code><code class="n">ben</code><code class="p">/</code><code class="n">project_git</code><code class="p">/.</code><code class="n">git</code><code class="p">/</code>
<code class="n">C15</code> <code class="p">=</code> <code class="n">b75da1aba1ffb359d00e85c52acb261e4586b0c9</code>
<code class="n">C16</code> <code class="p">=</code> <code class="n">c403405f4989d73a2c3c119e79021cb2104ce44a</code>
<code class="n">Tfs</code> <code class="n">branches</code> <code class="n">found</code><code class="err">:</code>
<code class="p">-</code> <code class="p">$/</code><code class="n">tfvc-test</code><code class="p">/</code><code class="n">featureA</code>
<code class="n">The</code> <code class="n">name</code> <code class="n">of</code> <code class="n">the</code> <code class="n">local</code> <code class="n">branch</code> <code class="n">will</code> <code class="n">be</code> <code class="err">:</code> <code class="n">featureA</code>
<code class="n">C17</code> <code class="p">=</code> <code class="n">d202b53f67bde32171d5078968c644e562f1c439</code>
<code class="n">C18</code> <code class="p">=</code> <code class="n">44cd729d8df868a8be20438fdeeefb961958b674</code>
</pre>

<p><code>--with-branches</code> フラグに注意してください。
git-tfs では TFVC のブランチを Git のブランチへマッピングできます。ここで <code>--with-branches</code> フラグは、 git-tfs に対し、すべての TFVC ブランチについて、対応するブランチをローカルの Git に作成するよう指示しています。
TFS 上で一度でもブランチの作成やマージを行っている場合、このオプションを指定することを強くお勧めします。ただし、このオプションは TFS 2010 より古いバージョンのサーバでは動作しません – それ以前のリリースでは “ブランチ” はただのフォルダだったためです。 git-tfs は単なるフォルダからはそのような指示は行えません。</p>

<p>結果の Git リポジトリを見てみましょう。</p>

<pre data-type="programlisting" data-code-language="powershell"><code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">log</code> <code class="p">-</code><code class="n">-oneline</code> <code class="p">-</code><code class="n">-graph</code> <code class="p">-</code><code class="n">-decorate</code> <code class="p">-</code><code class="n">-all</code>
<code class="p">*</code> <code class="n">44cd729</code> <code class="p">(</code><code class="n">tfs</code><code class="p">/</code><code class="n">featureA</code><code class="p">,</code> <code class="n">featureA</code><code class="p">)</code> <code class="n">Goodbye</code>
<code class="p">*</code> <code class="n">d202b53</code> <code class="n">Branched</code> <code class="n">from</code> <code class="p">$/</code><code class="n">tfvc-test</code><code class="p">/</code><code class="n">Trunk</code>
<code class="p">*</code> <code class="n">c403405</code> <code class="p">(</code><code class="n">HEAD</code><code class="p">,</code> <code class="n">tfs</code><code class="p">/</code><code class="k">default</code><code class="p">,</code> <code class="n">master</code><code class="p">)</code> <code class="n">Hello</code>
<code class="p">*</code> <code class="n">b75da1a</code> <code class="n">New</code> <code class="n">project</code>
<code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">log</code> <code class="p">-</code><code class="n">1</code>
<code class="n">commit</code> <code class="n">c403405f4989d73a2c3c119e79021cb2104ce44a</code>
<code class="n">Author</code><code class="err">:</code> <code class="n">Ben</code> <code class="n">Straub</code> <code class="p">&lt;</code><code class="n">ben</code><code class="nv">@straub</code><code class="p">.</code><code class="n">cc</code><code class="p">&gt;</code>
<code class="n">Date</code><code class="err">:</code>   <code class="n">Fri</code> <code class="n">Aug</code> <code class="n">1</code> <code class="n">03</code><code class="err">:</code><code class="n">41</code><code class="err">:</code><code class="n">59</code> <code class="n">2014</code> <code class="p">+</code><code class="n">0000</code>

    <code class="n">Hello</code>

    <code class="n">git-tfs-id</code><code class="err">:</code> <code class="p">[</code><code class="n">https</code><code class="err">:</code><code class="p">//</code><code class="n">username</code><code class="p">.</code><code class="n">visualstudio</code><code class="p">.</code><code class="n">com</code><code class="p">/</code><code class="n">DefaultCollection</code><code class="p">]$/</code><code class="n">myproject</code><code class="p">/</code><code class="n">Trunk</code><code class="p">;</code><code class="n">C16</code>
</pre>

<p>2つのローカルブランチ <code>master</code> と <code>featureA</code> があり、それぞれ最初のクローンの開始位置（ TFVC の <code>Trunk</code> ）と、子のブランチ（ TFVC の <code>featureA</code> ）を表しています。
また “リモート” <code>tfs</code> にも <code>default</code> と <code>featureA</code> の2つの参照があり、これは TFVC のブランチを表現しています。
git-tfs はクローン元のブランチを <code>tfs/default</code> へマッピングし、それ以外のブランチにはそれぞれのブランチ名を付与します。</p>

<p>もうひとつ注意すべき点として、コミットメッセージにある <code>git-tfs-id:</code> という行があります。
タグとは異なり、このマーカーは git-tfs が TFVC のチェンジセットを Git のコミットへ対応づけるのに使用しています。
これは、TFVC にプッシュする前と後とで Git のコミットの SHA-1 ハッシュが異なるということを暗黙的に意味しています。</p>
</section><section data-type="sect3" id="git-tfs-LPtKSwTzIW"><h4>git-tf[s] のワークフロー</h4>
<div data-type="note" id="id-2ZUAH6S9TqIk">
<h6>Note</h6>
<p>どちらのツールを使用するにせよ、問題を避けるため、次の2つの Git の設定値をセットする必要があります。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git config <code class="nb">set</code> --local core.ignorecase<code class="o">=</code><code class="nb">true</code>
<code class="gp">$</code><code class="nb"> </code>git config <code class="nb">set</code> --local core.autocrlf<code class="o">=</code><code class="nb">false</code>
</pre>
</div>

<p>当たり前ですが、次はプロジェクトに対して作業を行いたいことと思います。
TFVC および TFS には、ワークフローをややこしくする機能がいくつかあります。</p>
<ol>
<li>
<p>TFVC 上に現れないフィーチャーブランチがあると、ややこしさが増します。
これには、TFVC と Git とでブランチを表現する方法が <strong>まったく</strong> 異なることが関係しています。</p>
</li>
<li>
<p>TFVC では、ユーザがサーバからファイルを “チェックアウト” して、他の誰も編集できないようにロックを掛けられることを認識しておいてください。
ローカルリポジトリ上でファイルを編集する妨げには当然なりませんが、変更を TFVC サーバへプッシュする段になって邪魔になるかもしれません。</p>
</li>
<li>
<p>TFS には “ゲート” チェックインという概念があります。これは、チェックインが許可されるには、 TFS のビルドとテストのサイクルが正常に終了する必要がある、というものです。
これは TFVC の “シェルブ” 機能を使用していますが、これについてはここでは深入りしません。
  手作業でなら、git-tf でもこの方式をまねることはできます。 git-tfs はこれを考慮した <code>checkintool</code> コマンドを提供しています。</p>
</li>

</ol>
<p>話を簡潔にするため、ここで取り上げるのは、これらの問題を避けたり起こらないようにした、ハッピーな手順です。</p>
</section><section data-type="sect3" id="git-tf-0QtbfXT2I6"><h4>ワークフロー: <code>git-tf</code> の場合</h4>

<p>ここでは、いくつか作業を終えて、 <code>master</code> に Git のコミットを2つ作成し、作業の成果を TFVC サーバで共有する準備ができているものとします。
Git リポジトリはこんな内容です。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git log --oneline --graph --decorate --all
<code class="go">* 4178a82 (HEAD, master) update code</code>
<code class="go">* 9df2ae3 update readme</code>
<code class="go">* d44b17a (tag: TFS_C35190, origin_tfs/tfs) Goodbye</code>
<code class="go">* 126aa7b (tag: TFS_C35189)</code>
<code class="go">* 8f77431 (tag: TFS_C35178) FIRST</code>
<code class="go">* 0745a25 (tag: TFS_C35177) Created team project folder $/tfvctest via the \</code>
<code class="go">          Team Project Creation Wizard</code>
</pre>

<p><code>4178a82</code> のコミットでスナップショットを取って、 TFVC サーバへプッシュしたいものとします。
大事なことから先にとりかかりましょう。最後にリポジトリへ接続した後に、チームの他のメンバーが何か作業をしていなかったか見てみます。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git tf fetch
<code class="go">Username: domain\user</code>
<code class="go">Password:</code>
<code class="go">Connecting to TFS...</code>
<code class="go">Fetching $/myproject at latest changeset: 100%, done.</code>
<code class="go">Downloaded changeset 35320 as commit 8ef06a8. Updated FETCH_HEAD.</code>
<code class="gp">$</code> git log --oneline --graph --decorate --all
<code class="go">* 8ef06a8 (tag: TFS_C35320, origin_tfs/tfs) just some text</code>
<code class="go">| * 4178a82 (HEAD, master) update code</code>
<code class="go">| * 9df2ae3 update readme</code>
<code class="go">|/</code>
<code class="go">* d44b17a (tag: TFS_C35190) Goodbye</code>
<code class="go">* 126aa7b (tag: TFS_C35189)</code>
<code class="go">* 8f77431 (tag: TFS_C35178) FIRST</code>
<code class="go">* 0745a25 (tag: TFS_C35177) Created team project folder $/tfvctest via the \</code>
<code class="go">          Team Project Creation Wizard</code>
</pre>

<p>やはり、他の誰かが作業をしているようです。歴史が分岐しています。
これは Git が得意とするところですが、進め方は2種類あります。</p>
<ol>
<li>
<p>Git ユーザなら、マージコミットを行うのが自然に感じられるでしょう（ <code>git pull</code> が行うのがマージコミットなので）。 git-tf では単に <code>git tf pull</code> とすればマージコミットが行えます。
ですが、ここで注意が必要なのは、 TFVC はこれを自然とは考えないということです。マージコミットをプッシュしたら、歴史は Git 側と TFVC 側とで異なる見た目になりだし、ややこしいことになります。
一方、すべての変更をひとつのチェンジセットとして送信しようとしているのであれば、おそらくそれがもっとも簡単な選択肢です。</p>
</li>
<li>
<p>リベースを行うと、歴史がリニアになります。つまり、 Git のコミットひとつひとつを TFVC のチェンジセットへ変換する選択肢がとれるということです。
これが、以降の選択肢をもっとも広く取れる方法なので、この方法をお勧めします。git-tf でも、<code>git tf pull --rebase</code> で簡単に行えるようになっています。</p>
</li>

</ol>
<p>どの方法をとるかはあなた次第です。
この例では、リベースする方法をとったとします。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git rebase FETCH_HEAD
<code class="go">First, rewinding head to replay your work on top of it...</code>
<code class="go">Applying: update readme</code>
<code class="go">Applying: update code</code>
<code class="gp">$</code> git log --oneline --graph --decorate --all
<code class="go">* 5a0e25e (HEAD, master) update code</code>
<code class="go">* 6eb3eb5 update readme</code>
<code class="go">* 8ef06a8 (tag: TFS_C35320, origin_tfs/tfs) just some text</code>
<code class="go">* d44b17a (tag: TFS_C35190) Goodbye</code>
<code class="go">* 126aa7b (tag: TFS_C35189)</code>
<code class="go">* 8f77431 (tag: TFS_C35178) FIRST</code>
<code class="go">* 0745a25 (tag: TFS_C35177) Created team project folder $/tfvctest via the \</code>
<code class="go">          Team Project Creation Wizard</code>
</pre>

<p>さて、これで TFVC サーバへチェックインする準備ができました。
git-tf では、直近のチェンジセット以降のすべての変更を単一のチェンジセットにまとめる（ <code>--shallow</code> 、こっちがデフォルト）か、Git のコミットそれぞれに対して新しくチェンジセットを作成する（ <code>--deep</code> ）かを選択できます。
この例では、単一のチェンジセットにまとめる方法をとったとします。</p>

<pre data-type="programlisting" data-code-language="console"><code class="gp">$</code> git tf checkin -m <code class="s1">'Updating readme and code'</code>
<code class="go">Username: domain\user</code>
<code class="go">Password:</code>
<code class="go">Connecting to TFS...</code>
<code class="go">Checking in to $/myproject: 100%, done.</code>
<code class="go">Checked commit 5a0e25e in as changeset 35348</code>
<code class="gp">$</code> git log --oneline --graph --decorate --all
<code class="go">* 5a0e25e (HEAD, tag: TFS_C35348, origin_tfs/tfs, master) update code</code>
<code class="go">* 6eb3eb5 update readme</code>
<code class="go">* 8ef06a8 (tag: TFS_C35320) just some text</code>
<code class="go">* d44b17a (tag: TFS_C35190) Goodbye</code>
<code class="go">* 126aa7b (tag: TFS_C35189)</code>
<code class="go">* 8f77431 (tag: TFS_C35178) FIRST</code>
<code class="go">* 0745a25 (tag: TFS_C35177) Created team project folder $/tfvctest via the \</code>
<code class="go">          Team Project Creation Wizard</code>
</pre>

<p>新しくタグ <code>TFS_C35348</code> ができています。これは、 TFVC がコミット <code>5a0e25e</code> とまったく同じスナップショットを格納していることを意味します。
ここが重要なのですが、Git の各コミットが、すべて TFVC 側と対応づいている必要はありません。例えば、コミット <code>6eb3eb5</code> は、 TFVC サーバには存在しません。</p>

<p>以上が主なワークフローです。
他にも、考慮すべき点として気をつけるべきものが2つほどあります。</p>

<ul>
<li>
<p>ブランチはできません。
git-tf にできるのは、 TFVC のブランチから、 Git のリポジトリを作ることだけで、それも一度にひとつずつしか作れません。</p>
</li>
<li>
<p>共同作業の際は、 TFVC と Git のいずれかだけを使用し、両方は使用しないでください。
ひとつの TFVC リポジトリから、 git-tf で複数のクローンを作成した場合、各コミットの SHA-1 ハッシュそれぞれ異なります。コミットが作成されます。これは終わることのない頭痛の種になります。</p>
</li>
<li>
<p>チームのワークフローに Git との協調作業が含まれており、定期的に TFVC との同期を取る場合、 TFVC へ接続する Git リポジトリはひとつだけにしてください。</p>
</li>
</ul></section><section data-type="sect3" id="git-tfs-bRtrUNTLIL"><h4>ワークフロー: <code>git-tfs</code> の場合</h4>

<p>git-tfs を使用した場合と同じシナリオを見ていきましょう。
Git リポジトリには、 <code>master</code> ブランチに対して行った新しいコミットが入っています。</p>

<pre data-type="programlisting" data-code-language="powershell"><code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">log</code> <code class="p">-</code><code class="n">-oneline</code> <code class="p">-</code><code class="n">-graph</code> <code class="p">-</code><code class="n">-all</code> <code class="p">-</code><code class="n">-decorate</code>
<code class="p">*</code> <code class="n">c3bd3ae</code> <code class="p">(</code><code class="n">HEAD</code><code class="p">,</code> <code class="n">master</code><code class="p">)</code> <code class="n">update</code> <code class="n">code</code>
<code class="p">*</code> <code class="n">d85e5a2</code> <code class="n">update</code> <code class="n">readme</code>
<code class="p">|</code> <code class="p">*</code> <code class="n">44cd729</code> <code class="p">(</code><code class="n">tfs</code><code class="p">/</code><code class="n">featureA</code><code class="p">,</code> <code class="n">featureA</code><code class="p">)</code> <code class="n">Goodbye</code>
<code class="p">|</code> <code class="p">*</code> <code class="n">d202b53</code> <code class="n">Branched</code> <code class="n">from</code> <code class="p">$/</code><code class="n">tfvc-test</code><code class="p">/</code><code class="n">Trunk</code>
<code class="p">|/</code>
<code class="p">*</code> <code class="n">c403405</code> <code class="p">(</code><code class="n">tfs</code><code class="p">/</code><code class="k">default</code><code class="p">)</code> <code class="n">Hello</code>
<code class="p">*</code> <code class="n">b75da1a</code> <code class="n">New</code> <code class="n">project</code>
</pre>

<p>さて、我々が作業している間に、他の誰かが作業をしていなかったか見てみましょう。</p>

<pre data-type="programlisting" data-code-language="powershell"><code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">tfs</code> <code class="n">fetch</code>
<code class="n">C19</code> <code class="p">=</code> <code class="n">aea74a0313de0a391940c999e51c5c15c381d91d</code>
<code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">log</code> <code class="p">-</code><code class="n">-all</code> <code class="p">-</code><code class="n">-oneline</code> <code class="p">-</code><code class="n">-graph</code> <code class="p">-</code><code class="n">-decorate</code>
<code class="p">*</code> <code class="n">aea74a0</code> <code class="p">(</code><code class="n">tfs</code><code class="p">/</code><code class="k">default</code><code class="p">)</code> <code class="n">update</code> <code class="n">documentation</code>
<code class="p">|</code> <code class="p">*</code> <code class="n">c3bd3ae</code> <code class="p">(</code><code class="n">HEAD</code><code class="p">,</code> <code class="n">master</code><code class="p">)</code> <code class="n">update</code> <code class="n">code</code>
<code class="p">|</code> <code class="p">*</code> <code class="n">d85e5a2</code> <code class="n">update</code> <code class="n">readme</code>
<code class="p">|/</code>
<code class="p">|</code> <code class="p">*</code> <code class="n">44cd729</code> <code class="p">(</code><code class="n">tfs</code><code class="p">/</code><code class="n">featureA</code><code class="p">,</code> <code class="n">featureA</code><code class="p">)</code> <code class="n">Goodbye</code>
<code class="p">|</code> <code class="p">*</code> <code class="n">d202b53</code> <code class="n">Branched</code> <code class="n">from</code> <code class="p">$/</code><code class="n">tfvc-test</code><code class="p">/</code><code class="n">Trunk</code>
<code class="p">|/</code>
<code class="p">*</code> <code class="n">c403405</code> <code class="n">Hello</code>
<code class="p">*</code> <code class="n">b75da1a</code> <code class="n">New</code> <code class="n">project</code>
</pre>

<p>同僚が新しく TFVC のチェンジセットを追加しており、それが新しいコミット <code>aea74a0</code> として表示されている他に、リモートブランチ <code>tfs/default</code> が移動されていることがわかりました。</p>

<p>git-tf と同様に、この分岐した歴史を処理する基本的な方法は2つあります。</p>
<ol>
<li>
<p>歴史をリニアに保つためにリベースを行う。</p>
</li>
<li>
<p>実際に起こったことを残しておくためマージを行う。</p>
</li>

</ol>
<p>この例では、Git の各コミットが TFVC のチェンジセットになる “ディープ” なチェックインを行おうとしているので、リベースをします。</p>

<pre data-type="programlisting" data-code-language="powershell"><code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">rebase</code> <code class="n">tfs</code><code class="p">/</code><code class="k">default</code>
<code class="n">First</code><code class="p">,</code> <code class="n">rewinding</code> <code class="n">head</code> <code class="n">to</code> <code class="n">replay</code> <code class="n">your</code> <code class="n">work</code> <code class="n">on</code> <code class="n">top</code> <code class="n">of</code> <code class="n">it</code><code class="p">...</code>
<code class="n">Applying</code><code class="err">:</code> <code class="n">update</code> <code class="n">readme</code>
<code class="n">Applying</code><code class="err">:</code> <code class="n">update</code> <code class="n">code</code>
<code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">log</code> <code class="p">-</code><code class="n">-all</code> <code class="p">-</code><code class="n">-oneline</code> <code class="p">-</code><code class="n">-graph</code> <code class="p">-</code><code class="n">-decorate</code>
<code class="p">*</code> <code class="n">10a75ac</code> <code class="p">(</code><code class="n">HEAD</code><code class="p">,</code> <code class="n">master</code><code class="p">)</code> <code class="n">update</code> <code class="n">code</code>
<code class="p">*</code> <code class="n">5cec4ab</code> <code class="n">update</code> <code class="n">readme</code>
<code class="p">*</code> <code class="n">aea74a0</code> <code class="p">(</code><code class="n">tfs</code><code class="p">/</code><code class="k">default</code><code class="p">)</code> <code class="n">update</code> <code class="n">documentation</code>
<code class="p">|</code> <code class="p">*</code> <code class="n">44cd729</code> <code class="p">(</code><code class="n">tfs</code><code class="p">/</code><code class="n">featureA</code><code class="p">,</code> <code class="n">featureA</code><code class="p">)</code> <code class="n">Goodbye</code>
<code class="p">|</code> <code class="p">*</code> <code class="n">d202b53</code> <code class="n">Branched</code> <code class="n">from</code> <code class="p">$/</code><code class="n">tfvc-test</code><code class="p">/</code><code class="n">Trunk</code>
<code class="p">|/</code>
<code class="p">*</code> <code class="n">c403405</code> <code class="n">Hello</code>
<code class="p">*</code> <code class="n">b75da1a</code> <code class="n">New</code> <code class="n">project</code>
</pre>

<p>これで、コードを TFVC サーバへチェックインして、 作業を完了する準備ができました。
ここでは <code>rcheckin</code> コマンドを使用し、HEAD から始めて最初の <code>tfs</code> リモートブランチが見つかるまでの Git の各コミットに対して、 TFVC のチェンジセットを作成します（ <code>checkin</code> コマンドでは、 Git のコミットをスカッシュするのと同様に、チェンジセットをひとつだけ作成します）。</p>

<pre data-type="programlisting" data-code-language="powershell"><code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">tfs</code> <code class="n">rcheckin</code>
<code class="n">Working</code> <code class="n">with</code> <code class="n">tfs</code> <code class="n">remote</code><code class="err">:</code> <code class="k">default</code>
<code class="n">Fetching</code> <code class="n">changes</code> <code class="n">from</code> <code class="n">TFS</code> <code class="n">to</code> <code class="n">minimize</code> <code class="n">possibility</code> <code class="n">of</code> <code class="n">late</code> <code class="n">conflict</code><code class="p">...</code>
<code class="n">Starting</code> <code class="n">checkin</code> <code class="n">of</code> <code class="n">5cec4ab4</code> <code class="s1">'update readme'</code>
 <code class="n">add</code> <code class="n">README</code><code class="p">.</code><code class="n">md</code>
<code class="n">C20</code> <code class="p">=</code> <code class="n">71a5ddce274c19f8fdc322b4f165d93d89121017</code>
<code class="n">Done</code> <code class="n">with</code> <code class="n">5cec4ab4b213c354341f66c80cd650ab98dcf1ed</code><code class="p">,</code> <code class="n">rebasing</code> <code class="n">tail</code> <code class="n">onto</code> <code class="n">new</code> <code class="n">TFS-commit</code><code class="p">...</code>
<code class="n">Rebase</code> <code class="n">done</code> <code class="n">successfully</code><code class="p">.</code>
<code class="n">Starting</code> <code class="n">checkin</code> <code class="n">of</code> <code class="n">b1bf0f99</code> <code class="s1">'update code'</code>
 <code class="n">edit</code> <code class="p">.</code><code class="n">git</code><code class="p">\</code><code class="n">tfs</code><code class="p">\</code><code class="k">default</code><code class="p">\</code><code class="n">workspace</code><code class="p">\</code><code class="n">ConsoleApplication1</code><code class="p">/</code><code class="n">ConsoleApplication1</code><code class="p">/</code><code class="n">Program</code><code class="p">.</code><code class="n">cs</code>
<code class="n">C21</code> <code class="p">=</code> <code class="n">ff04e7c35dfbe6a8f94e782bf5e0031cee8d103b</code>
<code class="n">Done</code> <code class="n">with</code> <code class="n">b1bf0f9977b2d48bad611ed4a03d3738df05ea5d</code><code class="p">,</code> <code class="n">rebasing</code> <code class="n">tail</code> <code class="n">onto</code> <code class="n">new</code> <code class="n">TFS-commit</code><code class="p">...</code>
<code class="n">Rebase</code> <code class="n">done</code> <code class="n">successfully</code><code class="p">.</code>
<code class="n">No</code> <code class="n">more</code> <code class="n">to</code> <code class="n">rcheckin</code><code class="p">.</code>
<code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">log</code> <code class="p">-</code><code class="n">-all</code> <code class="p">-</code><code class="n">-oneline</code> <code class="p">-</code><code class="n">-graph</code> <code class="p">-</code><code class="n">-decorate</code>
<code class="p">*</code> <code class="n">ff04e7c</code> <code class="p">(</code><code class="n">HEAD</code><code class="p">,</code> <code class="n">tfs</code><code class="p">/</code><code class="k">default</code><code class="p">,</code> <code class="n">master</code><code class="p">)</code> <code class="n">update</code> <code class="n">code</code>
<code class="p">*</code> <code class="n">71a5ddc</code> <code class="n">update</code> <code class="n">readme</code>
<code class="p">*</code> <code class="n">aea74a0</code> <code class="n">update</code> <code class="n">documentation</code>
<code class="p">|</code> <code class="p">*</code> <code class="n">44cd729</code> <code class="p">(</code><code class="n">tfs</code><code class="p">/</code><code class="n">featureA</code><code class="p">,</code> <code class="n">featureA</code><code class="p">)</code> <code class="n">Goodbye</code>
<code class="p">|</code> <code class="p">*</code> <code class="n">d202b53</code> <code class="n">Branched</code> <code class="n">from</code> <code class="p">$/</code><code class="n">tfvc-test</code><code class="p">/</code><code class="n">Trunk</code>
<code class="p">|/</code>
<code class="p">*</code> <code class="n">c403405</code> <code class="n">Hello</code>
<code class="p">*</code> <code class="n">b75da1a</code> <code class="n">New</code> <code class="n">project</code>
</pre>

<p>TFVC サーバへのチェックインが成功した後に行われている処理に注目してください。 git-tfs は直前の処理結果に対して、残りの作業結果をリベースしています。
これは、コミットメッセージの末尾に <code>git-tfs-id</code> フィールドを追記しており、SHA-1 ハッシュが変化するためです。
これは仕様通りの動作であり、何も心配することはありません。ですが、そのような変更がなされていることは（特に、 Git のコミットを他の人と共有している場合は）認識しておいてください。</p>

<p>TFS には、ワークアイテム、レビュー依頼、ゲートチェックインなど、バージョン管理システムと統合されている機能が数多くあります。
これらの機能をコマンドラインツールだけで使うのは大変ですが、幸いなことに、  git-tfs ではグラフィカルなチェックインツールを簡単に起動できるようになっています。</p>

<pre data-type="programlisting" data-code-language="powershell"><code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">tfs</code> <code class="n">checkintool</code>
<code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">tfs</code> <code class="n">ct</code>
</pre>

<p>だいたいこんな感じで表示されます。</p>

<figure id="id-8OS6sMU5TBIW"><img src="../../en/v2/book/09-git-and-other-scms/images/git-tfs-ct.png" alt="git-tfs のチェックインツール"><figcaption><span class="label">Figure 9-3. </span>git-tfs のチェックインツール</figcaption></figure><p>TFS ユーザは見慣れていると思いますが、これは Visual Studio から表示されるものと同じダイアログです。</p>

<p>git-tfs では TFVC のブランチを Git のリポジトリから管理することもできます。
例として、ひとつ作成してみましょう。</p>

<pre data-type="programlisting" data-code-language="powershell"><code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">tfs</code> <code class="n">branch</code> <code class="p">$/</code><code class="n">tfvc-test</code><code class="p">/</code><code class="n">featureBee</code>
<code class="n">The</code> <code class="n">name</code> <code class="n">of</code> <code class="n">the</code> <code class="n">local</code> <code class="n">branch</code> <code class="n">will</code> <code class="n">be</code> <code class="err">:</code> <code class="n">featureBee</code>
<code class="n">C26</code> <code class="p">=</code> <code class="n">1d54865c397608c004a2cadce7296f5edc22a7e5</code>
<code class="n">PS</code><code class="p">&gt;</code> <code class="n">git</code> <code class="n">log</code> <code class="p">-</code><code class="n">-oneline</code> <code class="p">-</code><code class="n">-graph</code> <code class="p">-</code><code class="n">-decorate</code> <code class="p">-</code><code class="n">-all</code>
<code class="p">*</code> <code class="n">1d54865</code> <code class="p">(</code><code class="n">tfs</code><code class="p">/</code><code class="n">featureBee</code><code class="p">)</code> <code class="n">Creation</code> <code class="n">branch</code> <code class="p">$/</code><code class="n">myproject</code><code class="p">/</code><code class="n">featureBee</code>
<code class="p">*</code> <code class="n">ff04e7c</code> <code class="p">(</code><code class="n">HEAD</code><code class="p">,</code> <code class="n">tfs</code><code class="p">/</code><code class="k">default</code><code class="p">,</code> <code class="n">master</code><code class="p">)</code> <code class="n">update</code> <code class="n">code</code>
<code class="p">*</code> <code class="n">71a5ddc</code> <code class="n">update</code> <code class="n">readme</code>
<code class="p">*</code> <code class="n">aea74a0</code> <code class="n">update</code> <code class="n">documentation</code>
<code class="p">|</code> <code class="p">*</code> <code class="n">44cd729</code> <code class="p">(</code><code class="n">tfs</code><code class="p">/</code><code class="n">featureA</code><code class="p">,</code> <code class="n">featureA</code><code class="p">)</code> <code class="n">Goodbye</code>
<code class="p">|</code> <code class="p">*</code> <code class="n">d202b53</code> <code class="n">Branched</code> <code class="n">from</code> <code class="p">$/</code><code class="n">tfvc-test</code><code class="p">/</code><code class="n">Trunk</code>
<code class="p">|/</code>
<code class="p">*</code> <code class="n">c403405</code> <code class="n">Hello</code>
<code class="p">*</code> <code class="n">b75da1a</code> <code class="n">New</code> <code class="n">project</code>
</pre>

<p>TFVC でブランチを作成するということは、そのブランチが存在する場所にチェンジセットを追加するということなので、結果としてそれは Git のコミットへ反映されます。
git-tfs はリモートブランチ <code>tfs/featureBee</code> の <strong>作成は</strong> しましたが、 <code>HEAD</code> は相変わらず <code>master</code> を指していることに注意してください。
新しく作成したブランチ上で作業をしたい場合は、コミット <code>1d54865</code> から新しいコミットを作成することになりますが、この場合は恐らくそのコミットから新しくトピックブランチを作成することになるでしょう。</p>
</section><section data-type="sect3" id="git-tfs-9yt2coTAIj"><h4>Git と TFS のまとめ</h4>

<p>git-tf と git-tfs は、いずれも TFVC サーバに接続するための優れたツールです。
これらのツールにより、チーム全体を Git へ移行することなしに、ローカルで Git のパワーを享受でき、中央の TFVC サーバを定期的に巡回しなくて済み、開発者としての生活をより楽にすることができます。
Windows 上で作業をしているのなら（チームが TFS を使用しているなら多分そうだと思いますが）、機能がより網羅的な git-tfs を使用したいことと思います。また別のプラットフォーム上で作業をしているのなら、より機能の限られている git-tf を使用することになると思います。
この章で取り上げているほとんどのツールと同様、バージョン管理システムのうちひとつだけを正式なものとして、他は従属的な使い方にしておくべきです – Git か TFVC の両方ではなく、いずれか片方を共同作業の中心に置くべきです。</p>
</section></section><div id="nav"><a href="Git-%e3%81%ae%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%9e%e3%82%a4%e3%82%ba-%e3%81%be%e3%81%a8%e3%82%81.html">prev</a> | <a href="Git%e3%81%a8%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e3%81%ae%e9%80%a3%e6%90%ba-Git-%e3%81%b8%e7%a7%bb%e8%a1%8c%e3%81%99%e3%82%8b.html">next</a></div></div>
</div>

        </div>
      </div>
      <footer>
  <div class="site-source">
    This <a href="https://github.com/git/git-scm.com/blob/master/README.md#license">open sourced</a> site is <a href="https://github.com/git/git-scm.com">hosted on GitHub.</a><br>
    Patches, suggestions and comments are welcome.
  </div>
  <div class="sfc-member">
    Git is a member of <a href="http://git-scm.com/sfc">Software Freedom Conservancy</a>
  </div>
</footer>







    </div>

</body>
</html>
